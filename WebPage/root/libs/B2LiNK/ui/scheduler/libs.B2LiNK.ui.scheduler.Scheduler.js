(function(){function _schedulerComponentError(){return this.catches||(this.catches=[]),this}if(window.Lib=window.Lib||{},window.Lib.Ttw=window.Lib.Ttw||{},window.Lib.Ttw.CLASS=window.Lib.Ttw.CLASS||{},window.Lib.Ttw.CLASS.UIComponent=window.Lib.Ttw.CLASS.UIComponent||{},window.Lib.Ttw.CLASS.UIComponent.Scheduler)return window.Lib.Ttw.CLASS.UIComponent.Scheduler;Scheduler={_seed:0,scheduler:null},Scheduler.getSchedulerInstance=function(){var scheduler={};return scheduler.locale={date:{month_full:["1월","2월","3월","4월","5월","6월","7월","8월","9월","10월","11월","12월"],month_short:["1월","2월","3월","4월","5월","6월","7월","8월","9월","10월","11월","12월"],day_full:["일요일","월요일","화요일","수요일","목요일","금요일","토요일"],day_short:["일","월","화","수","목","금","토"]},labels:{sdr_cal_today_button:"오늘",day_tab:"일",week_tab:"주",month_tab:"월",year_tab:"년",new_event:"새 일정",icon_save:"작성완료",icon_cancel:"취소",icon_details:"자세히",icon_edit:"수정",icon_delete:"삭제",confirm_closing:"",confirm_deleting:"정말 삭제하시겠습니까?<br>일정을 삭제하면 복구할 수 없습니다!",section_description:"설명",section_time:"기간",full_day:"종일",confirm_recurring:"반복되는 모든 일정을 수정하시겠습니까?",section_recurring:"반복 일정",button_recurring:"사용불가",button_recurring_open:"사용가능",button_edit_series:"반복 일정 수정",button_edit_occurrence:"일정 수정",list_tab:"목록",date:"날짜",description:"설명",drag_to_create:"드래그로 생성",drag_to_move:"드래그로 이동",message_ok:"확인",message_cancel:"취소"}},scheduler.config={default_date:"%Y년 %M %d일",year_date:"%Y년",month_date:"%Y년 %F",week_date:"%l",day_date:"%M %d일 %D",hour_date:"%H:%i",month_day:"%d",load_date:"%Y-%m-%d",xml_date:"%Y-%m-%d %H:%i",api_date:"%Y-%m-%d %H:%i",repeat_date:"%Y.%m.%d",include_end_by:!0,full_day:!1,lightbox_recurring:"ask",occurrence_timestamp_in_utc:!0,recurring_workdays:[1,2,3,4,5],repeat_precise:!0,limit_time_select:!0,list_start:null,list_end:null,year_x:4,year_y:3,preserve_length:!0,time_step:5,start_on_monday:!1,first_hour:0,last_hour:24,reset_hour_year:2017,readonly:!0,view_page:!0,drag_resize:!0,drag_move:!0,drag_create:!0,dblclick_create:!0,details_on_create:!0,details_on_dblclick:!0,edit_on_create:!0,resize_month_events:!1,resize_month_timed:!1,cascade_event_display:!1,cascade_event_count:4,cascade_event_margin:30,multi_day:!0,multi_day_height_limit:0,drag_lightbox:!0,preserve_scroll:!0,select:!1,server_utc:!1,touch:!0,touch_tip:!0,touch_drag:500,quick_info_detached:!0,positive_closing:!1,drag_highlight:!0,limit_drag_out:!1,icons_edit:["icon_save","icon_cancel"],icons_select:["icon_details","icon_edit","icon_delete"],buttons_left:["sdr_save_btn","sdr_cancel_btn"],buttons_right:["sdr_delete_btn"],lightbox:{sections:[{name:"description",height:130,map_to:"text",type:"textarea",focus:!0},{name:"recurring",type:"recurring",map_to:"rec_type",button:"recurring"},{name:"time",height:72,type:"time",map_to:"auto"}]},highlight_displayed_event:!0,left_border:!1,ajax_error:"alert",prevent_cache:!0,fix_tab_position:!0,use_select_menu_space:!0,wide_form:!0,hour_size_px:42,displayed_event_color:"#ff4a4a",displayed_event_text_color:"#ffef80",use_month_tooltip:!0},scheduler.xy={year_top:0,min_event_height:40,scale_width:50,scroll_width:18,scale_height:20,month_scale_height:20,menu_width:25,margin_top:0,margin_left:0,editor_width:140,month_head_height:22,lightbox_additional_height:90,nav_height:59,bar_height:24},scheduler.keys={edit_save:13,edit_cancel:27},scheduler.__recurring_template='<div class="sdr_form_repeat"> <form> <div class="sdr_repeat_left"> <label><input class="sdr_repeat_radio" type="radio" name="repeat" value="day" />매일</label><br /> <label><input class="sdr_repeat_radio" type="radio" name="repeat" value="week"/>매주</label><br /> <label><input class="sdr_repeat_radio" type="radio" name="repeat" value="month" checked />매월</label><br /> <label><input class="sdr_repeat_radio" type="radio" name="repeat" value="year" />매년</label> </div> <div class="sdr_repeat_divider"></div> <div class="sdr_repeat_center"> <div style="display:none;" id="sdr_repeat_day"> <label><input class="sdr_repeat_radio" type="radio" name="day_type" value="d"/>반복 주기</label><input class="sdr_repeat_text" type="text" name="day_count" value="1" />일<br /> <label><input class="sdr_repeat_radio" type="radio" name="day_type" checked value="w"/>주중 매일</label> </div> <div style="display:none;" id="sdr_repeat_week">반복 주기 <input class="sdr_repeat_text" type="text" name="week_count" value="1" />주 다음 요일:<br /> <table class="sdr_repeat_days"> <tr> <td> <label><input class="sdr_repeat_checkbox" type="checkbox" name="week_day" value="1" />월</label><br /> <label><input class="sdr_repeat_checkbox" type="checkbox" name="week_day" value="4" />목</label> </td> <td> <label><input class="sdr_repeat_checkbox" type="checkbox" name="week_day" value="2" />화</label><br /> <label><input class="sdr_repeat_checkbox" type="checkbox" name="week_day" value="5" />금</label> </td> <td> <label><input class="sdr_repeat_checkbox" type="checkbox" name="week_day" value="3" />수</label><br /> <label><input class="sdr_repeat_checkbox" type="checkbox" name="week_day" value="6" />토</label> </td> <td> <label><input class="sdr_repeat_checkbox" type="checkbox" name="week_day" value="0" />일</label><br /><br /> </td> </tr> </table> </div> <div id="sdr_repeat_month"> <label><input class="sdr_repeat_radio" type="radio" name="month_type" value="d"/>Repeat</label><input class="sdr_repeat_text" type="text" name="month_day" value="1" />day every<input class="sdr_repeat_text" type="text" name="month_count" value="1" />month<br /> <label><input class="sdr_repeat_radio" type="radio" name="month_type" checked value="w"/>On</label><input class="sdr_repeat_text" type="text" name="month_week2" value="1" /><select name="month_day2"><option value="1" selected >Monday<option value="2">Tuesday<option value="3">Wednesday<option value="4">Thursday<option value="5">Friday<option value="6">Saturday<option value="0">Sunday</select>every<input class="sdr_repeat_text" type="text" name="month_count2" value="1" />month<br /> </div> <div style="display:none;" id="sdr_repeat_year"> <label><input class="sdr_repeat_radio" type="radio" name="year_type" value="d"/>Every</label><input class="sdr_repeat_text" type="text" name="year_day" value="1" />day<select name="year_month"><option value="0" selected >January<option value="1">February<option value="2">March<option value="3">April<option value="4">May<option value="5">June<option value="6">July<option value="7">August<option value="8">September<option value="9">October<option value="10">November<option value="11">December</select>month<br /> <label><input class="sdr_repeat_radio" type="radio" name="year_type" checked value="w"/>On</label><input class="sdr_repeat_text" type="text" name="year_week2" value="1" /><select name="year_day2"><option value="1" selected >Monday<option value="2">Tuesday<option value="3">Wednesday<option value="4">Thursday<option value="5">Friday<option value="6">Saturday<option value="7">Sunday</select>of<select name="year_month2"><option value="0" selected >January<option value="1">February<option value="2">March<option value="3">April<option value="4">May<option value="5">June<option value="6">July<option value="7">August<option value="8">September<option value="9">October<option value="10">November<option value="11">December</select><br /> </div> </div> <div class="sdr_repeat_divider"></div> <div class="sdr_repeat_right"> <label><input class="sdr_repeat_radio" type="radio" name="end" checked/>No end date</label><br /> <label><input class="sdr_repeat_radio" type="radio" name="end" />After</label><input class="sdr_repeat_text" type="text" name="occurences_count" value="1" />occurrences<br /> <label><input class="sdr_repeat_radio" type="radio" name="end" />End by</label><input class="sdr_repeat_date" type="text" name="date_of_end" value="'+scheduler.config.repeat_date_of_end+'" /><br /> </div> </form> </div> <div style="clear:both"> </div>',Scheduler.componentEventable(scheduler),Scheduler.eventObject._detachDomEvent=function(e,t,r){e.removeEventListener?e.removeEventListener(t,r,!1):e.detachEvent&&e.detachEvent("on"+t,r)},scheduler._init_once=function(){function e(){return{w:window.innerWidth||document.documentElement.clientWidth,h:window.innerHeight||document.documentElement.clientHeight}}function t(e,t){return e.w===t.w&&e.h===t.h}var r=e();scheduler._window_resize_event_handler=function(){var s=e();t(r,s)||(clearTimeout(scheduler._resize_timer),scheduler._resize_timer=setTimeout(function(){scheduler.callEvent("onSchedulerResize",[])&&(scheduler.update_view(),scheduler.callEvent("onAfterSchedulerResize",[]))},100)),r=s},Scheduler.eventObject._attachDomEvent(window,"resize",scheduler._window_resize_event_handler),scheduler._init_once=function(){}},scheduler.init=function(e,t,r){t=t||scheduler._currentDate(),r=r||"month",this._obj&&this.unset_actions(),this._obj="string"==typeof e?document.getElementById(e):e,this._skin_init&&scheduler._skin_init(),scheduler.date.init(),this._els=[],this._quirks=_isIE&&"BackCompat"===document.compatMode,this._quirks7=_isIE&&-1===navigator.appVersion.indexOf("MSIE 8"),this.get_elements(),this.init_templates(),this.set_actions(),this._init_touch_events(),this.set_sizes(),scheduler.callEvent("onSchedulerReady",[]),this.setCurrentView(t,r)},scheduler.set_sizes=function(){var e=this._x=this._obj.clientWidth-this.xy.margin_left,t=this._y=this._obj.clientHeight-this.xy.margin_top,r=this._table_view?0:this.xy.scale_width+this.xy.scroll_width,s=this._table_view?-1:this.xy.scale_width;this.set_xy(this._els.sdr_cal_navline[0],e,this.xy.nav_height,0,0),this.set_xy(this._els.sdr_cal_header[0],e-r,this.xy.scale_height,s,this.xy.nav_height+(this._quirks?-1:1));var a=this._els.sdr_cal_navline[0].offsetHeight;a>0&&(this.xy.nav_height=a);var i=this.xy.scale_height+this.xy.nav_height+(this._quirks?-2:0);this.set_xy(this._els.sdr_cal_data[0],e,t-(i+2),0,i+2)},scheduler.set_xy=function(e,t,r,s,a){e.style.width=Math.max(0,t)+"px",e.style.height=Math.max(0,r)+"px",arguments.length>3&&(e.style.left=s+"px",e.style.top=a+"px")},scheduler.get_elements=function(){for(var e=this._obj.getElementsByTagName("DIV"),t=0;t<e.length;t++){var r=e[t].className||"",s=e[t].getAttribute("data-name")||"";r&&(r=r.split(" ")[0]),this._els[r]||(this._els[r]=[]),this._els[r].push(e[t]);var a=scheduler.locale.labels[s||r];"string"!=typeof a&&s&&!e[t].innerHTML&&(a=s.split("_")[0]),a&&(e[t].innerHTML=a)}},scheduler.unset_actions=function(){for(var e in this._els)if(this._click[e])for(var t=0;t<this._els[e].length;t++)this._els[e][t].onclick=null;this._obj.onselectstart=null,this._obj.onmousemove=null,this._obj.onmousedown=null,this._obj.onmouseup=null,this._obj.ondblclick=null,this._obj.oncontextmenu=null},scheduler.set_actions=function(){for(var e in this._els)if(this._click[e])for(var t=0;t<this._els[e].length;t++)this._els[e][t].onclick=scheduler._click[e];this._obj.onselectstart=function(e){return!1},this._obj.onmousemove=function(e){scheduler._temp_touch_block||scheduler._on_mouse_move(e||event)},this._obj.onmousedown=function(e){scheduler._ignore_next_click||scheduler._on_mouse_down(e||event)},this._obj.onmouseup=function(e){scheduler._ignore_next_click||scheduler._on_mouse_up(e||event)},this._obj.ondblclick=function(e){scheduler._on_dbl_click(e||event)},this._obj.oncontextmenu=function(e){var t=e||event,r=t.target||t.srcElement,s=scheduler.callEvent("onContextMenu",[scheduler._locate_event(r),t]);return s}},scheduler.select=function(e){this._select_id!==e&&(scheduler._close_not_saved(),this.editStop(!1),this.unselect(),this._select_id=e,this.updateEvent(e))},scheduler.unselect=function(e){if(!e||e===this._select_id){var t=this._select_id;this._select_id=null,t&&this.getEvent(t)&&this.updateEvent(t)}},scheduler.getState=function(){return{mode:this._mode,date:new Date(this._date),min_date:new Date(this._min_date),max_date:new Date(this._max_date),editor_id:this._edit_id,lightbox_id:this._lightbox_id,new_event:this._new_event,select_id:this._select_id,expanded:this.expanded,drag_id:this._drag_id,drag_mode:this._drag_mode}},scheduler._click={sdr_cal_data:function(e){if(scheduler._ignore_next_click)return e.preventDefault&&e.preventDefault(),e.cancelBubble=!0,scheduler._ignore_next_click=!1,!1;var t=e?e.target:event.srcElement,r=scheduler._locate_event(t);if(e=e||event,r){if(!scheduler.callEvent("onClick",[r,e])||scheduler.config.readonly&&!scheduler.config.view_page)return;var s=(t.className||"").split(" ")[0];switch(s){case"sdr_cal_event":case"sdr_cal_event_line":case"sdr_cal_event_clear":scheduler.config.view_page&&scheduler.showModalPage(r)}scheduler.config.select&&scheduler.select(r);var a=t.className;-1!==a.indexOf("_icon")&&scheduler._click.buttons[a.split(" ")[1].replace("icon_","")](r)}else scheduler.callEvent("onEmptyClick",[scheduler.getActionData(e).date,e]),scheduler._close_not_saved(),(new Date).valueOf()-(scheduler._new_event||0)>500&&scheduler.unselect()},sdr_cal_prev_button:function(){scheduler._click.sdr_cal_next_button(0,-1)},sdr_cal_next_button:function(e,t){scheduler.setCurrentView(scheduler.date.add(scheduler.date[scheduler._mode+"_start"](scheduler._date),t||1,scheduler._mode))},sdr_cal_today_button:function(){scheduler.callEvent("onBeforeTodayDisplayed",[])&&scheduler.setCurrentView(scheduler._currentDate())},sdr_cal_tab:function(){var e=this.getAttribute("data-name"),t=e.substring(0,e.search("_tab"));scheduler.setCurrentView(scheduler._date,t)},buttons:{"delete":function(e){var t=scheduler.locale.labels.confirm_deleting;scheduler._component_confirm(t,scheduler.locale.labels.title_confirm_deleting,function(){scheduler.deleteEvent(e)})},edit:function(e){scheduler.edit(e)},save:function(e){scheduler.editStop(!0)},details:function(e){scheduler.config.view_page?scheduler.showModalPage(e):scheduler.showLightbox(e)},cancel:function(e){scheduler.editStop(!1)}}},scheduler._component_confirm=function(e,t,r){if(!e)return r();var s={text:e};t&&(s.title=t),r&&(s.callback=function(e){e&&r()}),Scheduler.component.confirm(s)},scheduler.addEventNow=function(e,t,r){var s={};e&&null!==e.constructor.toString().match(/object/i)&&(s=e,e=null);var a=6e4*(this.config.event_duration||this.config.time_step);e||(e=s.start_date||Math.round(scheduler._currentDate().valueOf()/a)*a);var i=new Date(e);if(!t){var n=this.config.first_hour;n>i.getHours()&&(i.setHours(n),e=i.valueOf()),t=e.valueOf()+a}var d=new Date(t);i.valueOf()===d.valueOf()&&d.setTime(d.valueOf()+a),s.start_date=s.start_date||i,s.end_date=s.end_date||d,s.text=s.text||this.locale.labels.new_event,s.id=this._drag_id=this.uid(),this._drag_mode="new-size",this._loading=!0,this.addEvent(s),this.callEvent("onEventCreated",[this._drag_id,r]),this._loading=!1,this._drag_event={},this._on_mouse_up(r)},scheduler._on_dbl_click=function(e,t){if(t=t||e.target||e.srcElement,!this.config.readonly){var r=(t.className||"").split(" ")[0];switch(r){case"sdr_month_body":if(this.config.readonly)return;if(!scheduler.config.dblclick_create)break;this.addEventNow(this.getActionData(e).date,null,e);break;case"sdr_cal_event":case"sdr_cal_event_line":case"sdr_cal_event_clear":var s=this._locate_event(t);if(this.config.view_page)this.showModalPage(s);else{if(!this.callEvent("onDblClick",[s,e]))return;this.config.details_on_dblclick||this._table_view||!this.getEvent(s)._timed||!this.config.select?this.showLightbox(s):this.edit(s)}break;case"sdr_cal_container":case"sdr_list_line":return;default:if(this.config.readonly&&!this.config.view_page)return;var a=this["dblclick_"+r];if(a)a.call(this,e);else if(t.parentNode&&t!==this)return scheduler._on_dbl_click(e,t.parentNode)}}},scheduler._get_column_index=function(e){var t=0;if(this._cols){for(var r=0,s=0;s<this._cols.length&&!r;s++)r=this._cols[s];if(t=r?e/r:0,this._ignores)for(var s=0;t>=s;s++)this._ignores[s]&&t++}return t},scheduler._week_indexes_from_pos=function(e){if(this._cols){var t=this._get_column_index(e.x);return e.x=Math.min(this._cols.length-1,Math.max(0,Math.ceil(t)-1)),e.y=Math.max(0,Math.ceil(60*e.y/(this.config.time_step*this.config.hour_size_px))-1)+this.config.first_hour*(60/this.config.time_step),e}return e},scheduler._mouse_coords=function(e){var t,r=document.body,s=document.documentElement;t=_isIE||!e.pageX&&!e.pageY?{x:e.clientX+(r.scrollLeft||s.scrollLeft||0)-r.clientLeft,y:e.clientY+(r.scrollTop||s.scrollTop||0)-r.clientTop}:{x:e.pageX,y:e.pageY},t.x-=Scheduler.util.getAbsoluteLeft(this._obj)+(this._table_view?0:this.xy.scale_width),t.y-=Scheduler.util.getAbsoluteTop(this._obj)+this.xy.nav_height+(this._dy_shift||0)+this.xy.scale_height-this._els.sdr_cal_data[0].scrollTop,t.ev=e;var a=this["mouse_"+this._mode];if(a)return a.call(this,t);if(this._table_view){var i=this._get_column_index(t.x);if(!this._cols||!this._colsS)return t;var n;for(n=1;n<this._colsS.heights.length&&!(this._colsS.heights[n]>t.y);n++);t.y=Math.ceil(24*(Math.max(0,i)+7*Math.max(0,n-1))*60/this.config.time_step),(scheduler._drag_mode||"month"===this._mode)&&(t.y=24*(Math.max(0,Math.ceil(i)-1)+7*Math.max(0,n-1))*60/this.config.time_step),"move"===this._drag_mode&&scheduler._ignores_detected&&scheduler.config.preserve_length&&(t._ignores=!0,this._drag_event._event_length||(this._drag_event._event_length=this._get_real_event_length(this._drag_event.start_date,this._drag_event.end_date,{x_step:1,x_unit:"day"}))),t.x=0}else t=this._week_indexes_from_pos(t);return t},scheduler._close_not_saved=function(){if((new Date).valueOf()-(scheduler._new_event||0)>500&&scheduler._edit_id){var e=scheduler.locale.labels.confirm_closing;scheduler._component_confirm(e,scheduler.locale.labels.title_confirm_closing,function(){scheduler.editStop(scheduler.config.positive_closing)}),e&&(this._drag_id=this._drag_pos=this._drag_mode=null)}},scheduler._correct_shift=function(e,t){return e-=6e4*(new Date(scheduler._min_date).getTimezoneOffset()-new Date(e).getTimezoneOffset())*(t?-1:1)},scheduler._is_pos_changed=function(e,t){function r(e,t,r){return!!(Math.abs(e-t)>r)}if(!e||!this._drag_pos)return!0;var s=100,a=5;return!!(!this._drag_pos.start||+new Date-this._drag_pos.start>s||r(e.x,t.x,a)||r(e.y,t.y,a))},scheduler._on_mouse_move=function(e){if(this._drag_mode){var t=this._mouse_coords(e);if(t.force_redraw||this._is_pos_changed(this._drag_pos,t)){var r,s;if(this._edit_id!==this._drag_id&&this._close_not_saved(),!this._drag_mode)return;if(this._drag_pos=t,this._drag_pos.has_moved=!0,"create"===this._drag_mode){if(this._close_not_saved(),this.unselect(this._select_id),this._loading=!0,r=this._get_date_from_pos(t).valueOf(),!this._drag_start){var a=this.callEvent("onBeforeEventCreated",[e,this._drag_id]);if(!a)return;return void(this._drag_start=r)}s=r;var i=new Date(this._drag_start),n=new Date(s);"day"!==this._mode&&"week"!==this._mode||i.getHours()!==n.getHours()||i.getMinutes()!==n.getMinutes()||(n=new Date(this._drag_start+1e3)),this._drag_id=this.uid(),this.addEvent(i,n,this.locale.labels.new_event,this._drag_id,t.fields),this.callEvent("onEventCreated",[this._drag_id,e]),this._loading=!1,this._drag_mode="new-size"}var d,l=this.getEvent(this._drag_id);if("move"===this._drag_mode)r=this._min_date.valueOf()+6e4*(t.y*this.config.time_step+24*t.x*60-(scheduler._move_pos_shift||0)),!t.custom&&this._table_view&&(r+=1e3*this.date.time_part(l.start_date)),r=this._correct_shift(r),t._ignores&&this.config.preserve_length&&this._table_view?(this.matrix&&(d=this.matrix[this._mode]),d=d||{x_step:1,x_unit:"day"},s=1*r+this._get_fictional_event_length(r,this._drag_event._event_length,d)):s=l.end_date.valueOf()-(l.start_date.valueOf()-r);else{if(r=l.start_date.valueOf(),s=l.end_date.valueOf(),this._table_view){var _=this._min_date.valueOf()+t.y*this.config.time_step*6e4+(t.custom?0:864e5);if("month"===this._mode)if(_=this._correct_shift(_,!1),this._drag_from_start){var o=864e5;_<=scheduler.date.date_part(new Date(s+o-1)).valueOf()&&(r=_-o)}else s=_;else t.resize_from_start?r=_:s=_}else s=this.date.date_part(new Date(l.end_date.valueOf()-1)).valueOf()+t.y*this.config.time_step*6e4,this._els.sdr_cal_data[0].style.cursor="s-resize",("week"===this._mode||"day"===this._mode)&&(s=this._correct_shift(s));if("new-size"===this._drag_mode)if(s<=this._drag_start){var c=t.shift||(this._table_view&&!t.custom?864e5:0);r=s-(t.shift?0:c),s=this._drag_start+(c||6e4*this.config.time_step)}else r=this._drag_start;else r>=s&&(s=r+6e4*this.config.time_step)}var h=new Date(s-1),u=new Date(r);if(scheduler.config.limit_drag_out&&(+u<+scheduler._min_date||+s>+scheduler._max_date)){var v=s-u;+u<+scheduler._min_date?(u=new Date(scheduler._min_date),s=new Date(+u+v)):(s=new Date(scheduler._max_date),u=new Date(+s-v)),h=new Date(s-1)}if(!this._table_view&&!scheduler.config.all_timed&&(!scheduler._get_section_view()&&t.x!==this._get_event_sday({start_date:new Date(s),end_date:new Date(s)})||new Date(s).getHours()>=this.config.last_hour)){var v=s-u,o=this._min_date.valueOf()+24*t.x*60*6e4;s=scheduler.date.date_part(new Date(o)),s.setHours(this.config.last_hour),h=new Date(s-1),"move"===this._drag_mode&&(u=new Date(+s-v))}if(this._table_view||h.getDate()===u.getDate()&&h.getHours()<this.config.last_hour||scheduler._allow_dnd)if(l.start_date=u,l.end_date=new Date(s),this.config.update_render){var f=scheduler._els.sdr_cal_data[0].scrollTop;this.update_view(),scheduler._els.sdr_cal_data[0].scrollTop=f}else this.updateEvent(this._drag_id);this._table_view&&this.for_rendered(this._drag_id,function(e){e.className+=" sdr_in_move"}),this.callEvent("onEventDrag",[this._drag_id,this._drag_mode,e])}}else if(scheduler.checkEvent("onMouseMove")){var g=this._locate_event(e.target||e.srcElement);this.callEvent("onMouseMove",[g,e])}},scheduler._on_mouse_down=function(e,t){if(2!==e.button&&!this.config.readonly&&!this._drag_mode){t=t||e.target||e.srcElement;var r=t.className&&t.className.split(" ")[0];switch(r){case"sdr_cal_event_line":case"sdr_cal_event_clear":this._table_view&&(this._drag_mode="move");break;case"sdr_event_move":this._drag_mode="move";break;case"sdr_event_resize":this._drag_mode="resize",(t.className||"").indexOf("sdr_event_resize_end")<0?scheduler._drag_from_start=!0:scheduler._drag_from_start=!1;break;case"sdr_scale_holder":case"sdr_scale_holder_now":case"sdr_month_body":case"sdr_matrix_cell":case"sdr_marked_timespan":this._drag_mode="create";break;case"":if(t.parentNode)return scheduler._on_mouse_down(e,t.parentNode);break;default:if((!scheduler.checkEvent("onMouseDown")||scheduler.callEvent("onMouseDown",[r]))&&t.parentNode&&t!==this&&"sdr_body"!==r)return scheduler._on_mouse_down(e,t.parentNode);this._drag_mode=null,this._drag_id=null}if(this._drag_mode){var s=this._locate_event(t);if(this.config["drag_"+this._drag_mode]&&this.callEvent("onBeforeDrag",[s,this._drag_mode,e])){if(this._drag_id=s,(this._edit_id!==this._drag_id||this._edit_id&&"create"===this._drag_mode)&&this._close_not_saved(),!this._drag_mode)return;this._drag_event=scheduler._lame_clone(this.getEvent(this._drag_id)||{}),this._drag_pos=this._mouse_coords(e),this._drag_pos.start=+new Date}else this._drag_mode=this._drag_id=0}this._drag_start=null}},scheduler._get_private_properties=function(e){var t={};for(var r in e)0===r.indexOf("_")&&(t[r]=!0);return t},scheduler._clear_temporary_properties=function(e,t){var r=this._get_private_properties(e),s=this._get_private_properties(t);for(var a in s)r[a]||delete t[a]},scheduler._on_mouse_up=function(e){if(!e||2!==e.button||!scheduler.config.touch){if(this._drag_mode&&this._drag_id){this._els.sdr_cal_data[0].style.cursor="default";var t=this._drag_id,r=this._drag_mode,s=!this._drag_pos||this._drag_pos.has_moved,a=this.getEvent(this._drag_id);if(s&&(this._drag_event._sdr_changed||!this._drag_event.start_date||a.start_date.valueOf()!==this._drag_event.start_date.valueOf()||a.end_date.valueOf()!==this._drag_event.end_date.valueOf())){var i="new-size"===this._drag_mode;if(this.callEvent("onBeforeEventChanged",[a,e,i,this._drag_event]))if(this._drag_id=this._drag_mode=null,i&&this.config.edit_on_create){if(this.unselect(),this._new_event=new Date,this._table_view||this.config.details_on_create||!this.config.select)return scheduler.callEvent("onDragEnd",[t,r,e]),this.showLightbox(t);this._drag_pos=!0,this._select_id=this._edit_id=t}else this._new_event||this.callEvent(i?"onEventAdded":"onEventChanged",[t,this.getEvent(t)]);else i?this.deleteEvent(a.id,!0):(this._drag_event._sdr_changed=!1,this._clear_temporary_properties(a,this._drag_event),scheduler._lame_copy(a,this._drag_event),this.updateEvent(a.id))}this._drag_pos&&(this._drag_pos.has_moved||this._drag_pos===!0)&&this.render_view_data(),scheduler.callEvent("onDragEnd",[t,r,e])}this._drag_id=null,this._drag_mode=null,this._drag_pos=null}},scheduler._trigger_dyn_loading=function(){return this._load_mode&&this._load()?(this._render_wait=!0,!0):!1},scheduler.isViewExists=function(e){return!!(scheduler[e+"_view"]||scheduler.date[e+"_start"]&&scheduler.templates[e+"_date"]&&scheduler.templates[e+"_scale_date"])},scheduler.update_view=function(){var e=this[this._mode+"_view"];return e?e(!0):this._reset_scale(),this._trigger_dyn_loading()?!0:void this.render_view_data()},scheduler.updateView=function(e,t){e=e||this._date,t=t||this._mode;var r="sdr_cal_data";this._mode?this._obj.className=this._obj.className.replace("sdr_scheduler_"+this._mode,"sdr_scheduler_"+t):this._obj.className+=" sdr_scheduler_"+t;var s=this._mode===t&&this.config.preserve_scroll?this._els[r][0].scrollTop:!1;this[this._mode+"_view"]&&t&&this._mode!==t&&this[this._mode+"_view"](!1),this._close_not_saved();var a="sdr_multi_day";this._els[a]&&(this._els[a][0].parentNode.removeChild(this._els[a][0]),this._els[a]=null),this._mode=t,this._date=e,this._table_view="month"===this._mode,this._dy_shift=0;var i=this._els.sdr_cal_tab;if(i)for(var n=0;n<i.length;n++){var d=i[n].className;d=d.replace(/ active/g,""),i[n].getAttribute("data-name")===this._mode+"_tab"&&(d+=" active"),i[n].className=d}this.update_view(),"number"==typeof s&&(this._els[r][0].scrollTop=s),this.config.use_month_tooltip&&("month"===t?scheduler._init_month_tooltip():scheduler._removeMonthTooltip())},scheduler.setCurrentView=function(e,t){this.callEvent("onBeforeViewChange",[this._mode,this._date,t||this._mode,e||this._date])&&(this.updateView(e,t),this.callEvent("onViewChange",[this._mode,this._date]))},scheduler._render_x_header=function(e,t,r,s,a){a=a||0;var i=document.createElement("DIV");i.className="sdr_scale_bar",this.templates[this._mode+"_scalex_class"]&&(i.className+=" "+this.templates[this._mode+"_scalex_class"](r));var n=this._cols[e]-1;"month"===this._mode&&0===e&&this.config.left_border&&(i.className+=" sdr_scale_bar_border",t+=1),this.set_xy(i,n,this.xy.scale_height-2,t,a),i.innerHTML=this.templates[this._mode+"_scale_date"](r,this._mode),s.appendChild(i)},scheduler._get_columns_num=function(e,t){var r=7;if(!scheduler._table_view){var s=scheduler.date["get_"+scheduler._mode+"_end"];s&&(t=s(e)),r=Math.round((t.valueOf()-e.valueOf())/864e5)}return r},scheduler._get_timeunit_start=function(){return this.date[this._mode+"_start"](new Date(this._date.valueOf()))},scheduler._get_view_end=function(){var e=this._get_timeunit_start(),t=scheduler.date.add(e,1,this._mode);if(!scheduler._table_view){var r=scheduler.date["get_"+scheduler._mode+"_end"];r&&(t=r(e))}return t},scheduler._calc_scale_sizes=function(e,t,r){var s=e,a=this._get_columns_num(t,r);this._process_ignores(t,a,"day",1);for(var i=a-this._ignores_detected,n=0;a>n;n++)this._ignores[n]?(this._cols[n]=0,i++):this._cols[n]=Math.floor(s/(i-n)),s-=this._cols[n],this._colsS[n]=(this._cols[n-1]||0)+(this._colsS[n-1]||(this._table_view?0:this.xy.scale_width+2));this._colsS.col_length=a,this._colsS[a]=this._cols[a-1]+this._colsS[a-1]||0},scheduler._set_scale_col_size=function(e,t,r){var s=this.config;this.set_xy(e,t-1,s.hour_size_px*(s.last_hour-s.first_hour),r+this.xy.scale_width+1,0)},scheduler._render_scales=function(e,t){var r=new Date(scheduler._min_date),s=new Date(scheduler._max_date),a=this.date.date_part(scheduler._currentDate()),i=parseInt(e.style.width,10),n=new Date(this._min_date),d=this._get_columns_num(r,s);this._calc_scale_sizes(i,r,s);var l=0;e.innerHTML="";for(var _=0;d>_;_++){if(this._ignores[_]||this._render_x_header(_,l,n,e),!this._table_view){var o=document.createElement("DIV"),c="sdr_scale_holder";n.valueOf()===a.valueOf()&&(c="sdr_scale_holder_now"),this._ignores_detected&&this._ignores[_]&&(c+=" sdr_scale_ignore"),o.className=c+" "+this.templates.week_date_class(n,a),this._set_scale_col_size(o,this._cols[_],l),t.appendChild(o),this.callEvent("onScaleAdd",[o,n])}l+=this._cols[_],n=this.date.add(n,1,"day"),n=this.date.day_start(n)}},scheduler._reset_scale=function(){if(this.templates[this._mode+"_date"]){var e=this._els.sdr_cal_header[0],t=this._els.sdr_cal_data[0],r=this.config;e.innerHTML="",t.innerHTML="";var s=(r.readonly||!r.drag_resize?" sdr_resize_denied":"")+(r.readonly||!r.drag_move?" sdr_move_denied":"");t.className="sdr_cal_data"+s,this._scales={},this._cols=[],this._colsS={height:0},this._dy_shift=0,this.set_sizes();var a,i,n=this._get_timeunit_start(),d=scheduler._get_view_end();if(a=i=this._table_view?scheduler.date.week_start(n):n,this._min_date=a,this._els.sdr_cal_date[0].innerHTML=this.templates[this._mode+"_date"](n,d,this._mode),this._max_date=d,scheduler._render_scales(e,t),this._table_view)this._reset_month_scale(t,n,i);else if(this._reset_hours_scale(t,n,i),r.multi_day){var l="sdr_multi_day";this._els[l]&&(this._els[l][0].parentNode.removeChild(this._els[l][0]),this._els[l]=null);var _=this._els.sdr_cal_navline[0],o=_.offsetHeight+this._els.sdr_cal_header[0].offsetHeight+1,c=document.createElement("DIV");c.className=l,c.style.visibility="hidden",this.set_xy(c,Math.max(this._colsS[this._colsS.col_length]+this.xy.scroll_width-2,0),0,0,o),t.parentNode.insertBefore(c,t);var h=c.cloneNode(!0);h.className=l+"_icon",h.style.visibility="hidden",this.set_xy(h,this.xy.scale_width,0,0,o),c.appendChild(h),this._els[l]=[c,h],this._els[l][0].onclick=this._click.sdr_cal_data}}},scheduler._reset_hours_scale=function(e,t,r){var s=document.createElement("DIV");s.className="sdr_scale_holder";for(var a=new Date(this.config.reset_hour_year,0,1,this.config.first_hour,0,0),i=1*this.config.first_hour;i<this.config.last_hour;i++){var n=document.createElement("DIV");n.className="sdr_scale_hour",n.style.height=this.config.hour_size_px-(this._quirks?0:1)+"px";var d=this.xy.scale_width;this.config.left_border&&(d-=1,n.className+=" sdr_scale_hour_border"),n.style.width=d+"px",n.innerHTML=scheduler.templates.hour_scale(a),s.appendChild(n),a=this.date.add(a,1,"hour")}e.appendChild(s),this.config.scroll_hour&&(e.scrollTop=this.config.hour_size_px*(this.config.scroll_hour-this.config.first_hour))},scheduler._currentDate=function(){return scheduler.config.now_date?new Date(scheduler.config.now_date):new Date},scheduler._process_ignores=function(e,t,r,s,a){this._ignores={},this._ignores_detected=0;var i=scheduler["ignore_"+this._mode];if(i)for(var n=new Date(e),d=0;t>d;d++)i(n)&&(this._ignores_detected+=1,this._ignores[d]=!0,a&&t++),n=scheduler.date.add(n,s,r),scheduler.date[r+"_start"]&&(n=scheduler.date[r+"_start"](n))},scheduler._render_month_scale=function(e,t,r){function s(e){var t=scheduler._colsS.height;return void 0!==scheduler._colsS.heights[e+1]&&(t=scheduler._colsS.heights[e+1]-(scheduler._colsS.heights[e]||0)),t}var a=scheduler.date.add(t,1,"month"),i=new Date(r),n=scheduler._currentDate();this.date.date_part(n),this.date.date_part(r);for(var d=Math.ceil(Math.round((a.valueOf()-r.valueOf())/864e5)/7),l=[],_=0;7>=_;_++){var o=(this._cols[_]||0)-1;0===_&&this.config.left_border&&(o-=1),l[_]=" style='width:"+o+"px;"}for(var c=0,h="<table cellpadding='0' cellspacing='0'>",u=[],_=0;d>_;_++){h+="<tr>";for(var v=Math.max(s(_)-scheduler.xy.month_head_height,0),f=0;7>f;f++){h+="<td";var g="";t>r?g="sdr_before":r>=a?g="sdr_after":r.valueOf()===n.valueOf()&&(g="sdr_now"),this._ignores_detected&&this._ignores[f]&&(g+=" sdr_scale_ignore"),h+=" class='"+g+" "+this.templates.month_date_class(r,n)+"' >";var m="sdr_month_body",p="sdr_month_head";0===f&&this.config.left_border&&(m+=" sdr_month_body_border",p+=" sdr_month_head_border"),this._ignores_detected&&this._ignores[f]?h+="<div></div><div></div>":(h+="<div class='"+p+"'>"+this.templates.month_day(r)+"</div>",h+="<div class='"+m+"' "+l[f]+";height:"+v+"px;'></div></td>"),u.push(r);var y=r.getDate();r=this.date.add(r,1,"day"),r.getDate()-y>1&&(r=new Date(r.getFullYear(),r.getMonth(),y+1,12,0))}h+="</tr>",scheduler._colsS.heights[_]=c,c+=s(_)}h+="</table>",this._min_date=i,this._max_date=r,e.innerHTML=h,this._scales={};for(var b=e.getElementsByTagName("div"),_=0;_<u.length;_++){var e=b[2*_+1],x=u[_];this._scales[+x]=e}for(var _=0;_<u.length;_++){var x=u[_];this.callEvent("onScaleAdd",[this._scales[+x],x])}return this._max_date},scheduler._reset_month_scale=function(e,t,r){var s=scheduler.date.add(t,1,"month"),a=scheduler._currentDate();this.date.date_part(a),this.date.date_part(r);var i=Math.ceil(Math.round((s.valueOf()-r.valueOf())/864e5)/7),n=Math.floor(e.clientHeight/i)-this.xy.month_head_height;return this._colsS.height=n+this.xy.month_head_height,this._colsS.heights=[],scheduler._render_month_scale(e,t,r)},scheduler.getLabel=function(e,t){for(var r=this.config.lightbox.sections,s=0;s<r.length;s++)if(r[s].map_to===e)for(var a=r[s].options,i=0;i<a.length;i++)if(a[i].key===t)return a[i].label;return""},scheduler._lame_clone=function(e,t){var r,s,a;for(t=t||[],r=0;r<t.length;r+=2)if(e===t[r])return t[r+1];if(e&&"object"==typeof e){for(a={},s=[Array,Date,Number,String,Boolean],r=0;r<s.length;r++)e instanceof s[r]&&(a=r?new s[r](e):new s[r]);t.push(e,a);for(r in e)Object.prototype.hasOwnProperty.apply(e,[r])&&(a[r]=scheduler._lame_clone(e[r],t))}return a||e},scheduler._lame_copy=function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);return e},scheduler._get_date_from_pos=function(e){var t=this._min_date.valueOf()+6e4*(e.y*this.config.time_step+24*(this._table_view?0:e.x)*60);return new Date(this._correct_shift(t))},scheduler.getActionData=function(e){var t=this._mouse_coords(e);return{date:this._get_date_from_pos(t),section:t.section}},scheduler._focus=function(e,t){e&&e.focus&&(this.config.touch?setTimeout(function(){e.focus()},100):(t&&e.select&&e.select(),e.focus()))},scheduler._get_real_event_length=function(e,t,r){var s,a=t-e,i=r._start_correction+r._end_correction||0,n=this["ignore_"+this._mode],d=0;for(r.render?(d=this._get_date_index(r,e),s=this._get_date_index(r,t)):s=Math.round(a/60/60/1e3/24);s>d;){var l=scheduler.date.add(t,-r.x_step,r.x_unit);a-=n&&n(t)?t-l:i,t=l,s--}return a},scheduler._get_fictional_event_length=function(e,t,r,s){var a=new Date(e),i=s?-1:1;if(r._start_correction||r._end_correction){var n;n=s?60*a.getHours()+a.getMinutes()-60*(r.first_hour||0):60*(r.last_hour||0)-(60*a.getHours()+a.getMinutes());var d=60*(r.last_hour-r.first_hour),l=Math.ceil((t/6e4-n)/d);t+=l*(1440-d)*60*1e3}var _,o=new Date(1*e+t*i),c=this["ignore_"+this._mode],h=0;for(r.render?(h=this._get_date_index(r,a),_=this._get_date_index(r,o)):_=Math.round(t/60/60/1e3/24);_*i>=h*i;){var u=scheduler.date.add(a,r.x_step*i,r.x_unit);c&&c(a)&&(t+=(u-a)*i,_+=i),a=u,h+=i}return t},scheduler._get_section_view=function(){return this.matrix&&this.matrix[this._mode]?this.matrix[this._mode]:this._props&&this._props[this._mode]?this._props[this._mode]:null},scheduler._get_section_property=function(){return this.matrix&&this.matrix[this._mode]?this.matrix[this._mode].y_property:this._props&&this._props[this._mode]?this._props[this._mode].map_to:null},scheduler._is_initialized=function(){var e=this.getState();return this._obj&&e.date&&e.mode},scheduler._is_lightbox_open=function(){var e=this.getState();return null!==e.lightbox_id&&void 0!==e.lightbox_id},scheduler.date={init:function(){for(var e=scheduler.locale.date.month_short,t=scheduler.locale.date.month_short_hash={},r=0;r<e.length;r++)t[e[r]]=r;for(var e=scheduler.locale.date.month_full,t=scheduler.locale.date.month_full_hash={},r=0;r<e.length;r++)t[e[r]]=r},date_part:function(e){var t=new Date(e);return e.setHours(0),e.setMinutes(0),e.setSeconds(0),e.setMilliseconds(0),e.getHours()&&(e.getDate()<t.getDate()||e.getMonth()<t.getMonth()||e.getFullYear()<t.getFullYear())&&e.setTime(e.getTime()+36e5*(24-e.getHours())),e},time_part:function(e){return(e.valueOf()/1e3-60*e.getTimezoneOffset())%86400},week_start:function(e){var t=e.getDay();return scheduler.config.start_on_monday&&(0===t?t=6:t--),this.date_part(this.add(e,-1*t,"day"))},month_start:function(e){return e.setDate(1),this.date_part(e)},year_start:function(e){return e.setMonth(0),this.month_start(e)},day_start:function(e){return this.date_part(e)},_add_days:function(e,t){var r=new Date(e.valueOf());return r.setDate(r.getDate()+t),t>=0&&!e.getHours()&&r.getHours()&&(r.getDate()<e.getDate()||r.getMonth()<e.getMonth()||r.getFullYear()<e.getFullYear())&&r.setTime(r.getTime()+36e5*(24-r.getHours())),r},add:function(e,t,r){var s=new Date(e.valueOf());switch(r){case"day":s=scheduler.date._add_days(s,t);break;case"week":s=scheduler.date._add_days(s,7*t);break;case"month":s.setMonth(s.getMonth()+t);break;case"year":s.setYear(s.getFullYear()+t);break;case"hour":s.setTime(s.getTime()+60*t*60*1e3);break;case"minute":s.setTime(s.getTime()+60*t*1e3);break;default:return scheduler.date["add_"+r](e,t,r)}return s},to_fixed:function(e){return 10>e?"0"+e:e},copy:function(e){return new Date(e.valueOf())},date_to_str:function(e,t){return e=e.replace(/%[a-zA-Z]/g,function(e){switch(e){case"%d":return'"+Scheduler.scheduler.date.to_fixed(date.getDate())+"';case"%m":return'"+Scheduler.scheduler.date.to_fixed((date.getMonth()+1))+"';case"%j":return'"+date.getDate()+"';case"%n":return'"+(date.getMonth()+1)+"';case"%y":return'"+Scheduler.scheduler.date.to_fixed(date.getFullYear()%100)+"';case"%Y":return'"+date.getFullYear()+"';case"%D":return'"+Scheduler.scheduler.locale.date.day_short[date.getDay()]+"';case"%l":return'"+Scheduler.scheduler.locale.date.day_full[date.getDay()]+"';case"%M":return'"+Scheduler.scheduler.locale.date.month_short[date.getMonth()]+"';case"%F":return'"+Scheduler.scheduler.locale.date.month_full[date.getMonth()]+"';case"%h":return'"+Scheduler.scheduler.date.to_fixed((date.getHours()+11)%12+1)+"';case"%g":return'"+((date.getHours()+11)%12+1)+"';case"%G":return'"+date.getHours()+"';case"%H":return'"+Scheduler.scheduler.date.to_fixed(date.getHours())+"';case"%i":return'"+Scheduler.scheduler.date.to_fixed(date.getMinutes())+"';case"%a":return'"+(date.getHours()>11?"pm":"am")+"';case"%A":return'"+(date.getHours()>11?"PM":"AM")+"';case"%s":return'"+Scheduler.scheduler.date.to_fixed(date.getSeconds())+"';case"%W":return'"+Scheduler.scheduler.date.to_fixed(Scheduler.scheduler.date.getISOWeek(date))+"';default:return e}}),t&&(e=e.replace(/date\.get/g,"date.getUTC")),new Function("date",'return "'+e+'";')},str_to_date:function(e,t){for(var r="var temp=date.match(/[a-zA-Z]+|[0-9]+/g);",s=e.match(/%[a-zA-Z]/g),a=0;a<s.length;a++)switch(s[a]){case"%j":case"%d":r+="set[ 2 ]=temp["+a+"]||1;";break;case"%n":case"%m":r+="set[ 1 ]=(temp["+a+"]||1)-1;";break;case"%y":r+="set[ 0 ]=temp["+a+"]*1+(temp["+a+"]>50?1900:2000);";break;case"%g":case"%G":case"%h":case"%H":r+="set[ 3 ]=temp["+a+"]||0;";break;case"%i":r+="set[ 4 ]=temp["+a+"]||0;";break;case"%Y":r+="set[ 0 ]=temp["+a+"]||0;";break;case"%a":case"%A":r+="set[ 3 ]=set[ 3 ]%12+((temp["+a+"]||'').toLowerCase()=='am'?0:12);";break;case"%s":r+="set[5]=temp["+a+"]||0;";break;case"%M":r+="set[ 1 ]=Scheduler.scheduler.locale.date.month_short_hash[temp["+a+"]]||0;";break;case"%F":r+="set[ 1 ]=Scheduler.scheduler.locale.date.month_full_hash[temp["+a+"]]||0;"}var i="set[ 0 ],set[ 1 ],set[ 2 ],set[ 3 ],set[ 4 ],set[5]";return t&&(i=" Date.UTC("+i+")"),new Function("date","var set=[0,0,1,0,0,0]; "+r+" return new Date("+i+" );")},getISOWeek:function(e){if(!e)return!1;var t=e.getDay();0===t&&(t=7);var r=new Date(e.valueOf());r.setDate(e.getDate()+(4-t));var s=r.getFullYear(),a=Math.round((r.getTime()-new Date(s,0,1).getTime())/864e5),i=1+Math.floor(a/7);return i},getUTCISOWeek:function(e){return this.getISOWeek(this.convert_to_utc(e))},convert_to_utc:function(e){return new Date(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds())},day_week:function(e,t,r){e.setDate(1),r=7*(r-1);var s=e.getDay(),a=1*t+r-s+1;e.setDate(r>=a?a+7:a)},add_list:function(e){return this.add(e,1,"year")},list_start:function(){return this.date_part(scheduler._currentDate())}},scheduler.templates={},scheduler.init_templates=function(){var e=scheduler.locale.labels;e.sdr_save_btn=e.icon_save,e.sdr_cancel_btn=e.icon_cancel,e.sdr_delete_btn=e.icon_delete;var t=scheduler.date.date_to_str,r=scheduler.date.str_to_date,s=scheduler.config,a=function(e,t){for(var r in t)e[r]||(e[r]=t[r])};a(scheduler.templates,{day_date:t(s.default_date),month_date:t(s.month_date),week_date:function(e,t){return scheduler.templates.day_date(e)+" ~ "+scheduler.templates.day_date(scheduler.date.add(t,-1,"day"))},day_scale_date:t(s.default_date),month_scale_date:t(s.week_date),week_scale_date:t(s.day_date),hour_scale:t(s.hour_date),time_picker:t(s.hour_date),event_date:t(s.hour_date),month_day:t(s.month_day),xml_date:r(s.xml_date,s.server_utc),load_format:t(s.load_date,s.server_utc),xml_format:t(s.xml_date,s.server_utc),api_date:r(s.api_date),event_header:function(e,t,r){return scheduler.templates.event_date(e)+" ~ "+scheduler.templates.event_date(t)},event_text:function(e,t,r){return r.text},event_class:function(e,t,r){var s=[];if(r.type)if(r.oversea?s.push("event_"+r.type+"_oversea"):s.push("event_"+r.type),r.completed)s.push("event_completed");else{var a=r.end_date-scheduler._currentDate();1>a&&s.push("event_incomplete")}return r.id===scheduler.getState().select_id&&s.push("selected"),s.join(" ")},month_date_class:function(e){return 10===e.getMonth()&&11===e.getDate()?"special_day":""},week_date_class:function(e){return""},event_bar_date:function(e,t,r){return scheduler.templates.event_date(e)+" "},event_bar_text:function(e,t,r){return r.text},month_events_link:function(e,t){return"<a>View more("+t+" events)</a>"},drag_marker_class:function(e,t,r){return""},drag_marker_content:function(e,t,r){return""}}),this.callEvent("onTemplatesReady",[])},scheduler.uid=function(){return this._seed||(this._seed=(new Date).valueOf()),this._seed++},scheduler._events={},scheduler.clearAll=function(){this._events={},this._loaded={},this._edit_id=null,this._select_id=null,this._drag_id=null,this._drag_mode=null,this._drag_pos=null,this.clear_view(),this.callEvent("onClearAll",[])},scheduler.destroy=function(){this.clearAll(),this.removeLightbox(),this.detachAllEvents(),this._removeMonthTooltip(),this._removeYearTooltip(),this._detachDomEvent(window,"resize",scheduler._window_resize_event_handler);var e=this._els?this._els.sdr_cal_navline[0]:null;e&&(e.parentElement.innerHTML=""),this._els=null,this._obj=null},scheduler.addEvent=function(e,t,r,s,a){if(!arguments.length)return this.addEventNow();var i=e;1!==arguments.length&&(i=a||{},i.start_date=e,i.end_date=t,i.text=r,i.id=s),i.id=i.id||scheduler.uid(),i.text=i.text||"","string"==typeof i.start_date&&(i.start_date=this.templates.api_date(i.start_date)),"string"==typeof i.end_date&&(i.end_date=this.templates.api_date(i.end_date));var n=6e4*(this.config.event_duration||this.config.time_step);i.start_date.valueOf()===i.end_date.valueOf()&&i.end_date.setTime(i.end_date.valueOf()+n),i._timed=this.isOneDayEvent(i);var d=!this._events[i.id];return this._events[i.id]=i,this.event_updated(i),this._loading||this.callEvent(d?"onEventAdded":"onEventChanged",[i.id,i]),i.id&&(i=scheduler.getEvent(i.id),this._is_modified_occurence(i)&&scheduler._add_rec_marker(i,1e3*i.event_length),i.rec_type&&(i.rec_pattern=i.rec_type.split("#")[0])),i.id},scheduler.deleteEvent=function(e,t){var r=this._events[e];(t||this.callEvent("onBeforeEventDelete",[e,r])&&this.callEvent("onConfirmedBeforeEventDelete",[e,r]))&&(r&&(this._select_id=null,delete this._events[e],this.event_updated(r)),this.callEvent("onEventDeleted",[e,r]))},scheduler.getEvent=function(e){return this._events[e]},scheduler.setEvent=function(e,t){t.id||(t.id=e),this._events[e]=t},scheduler.for_rendered=function(e,t){for(var r=this._rendered.length-1;r>=0;r--)this._rendered[r].getAttribute("data-event-id")===e&&t(this._rendered[r],r)},scheduler.changeEventId=function(e,t){if(e!==t){var r=this._events[e];r&&(r.id=t,this._events[t]=r,delete this._events[e]),this.for_rendered(e,function(e){e.setAttribute("data-event-id",t)}),this._select_id===e&&(this._select_id=t),this._edit_id===e&&(this._edit_id=t),this.callEvent("onEventIdChange",[e,t])}},function(){for(var e=["text","Text","start_date","StartDate","end_date","EndDate"],t=function(e){return function(t){return scheduler.getEvent(t)[e]}},r=function(e){return function(t,r){var s=scheduler.getEvent(t);s[e]=r,s._changed=!0,s._timed=this.isOneDayEvent(s),scheduler.event_updated(s,!0)}},s=0;s<e.length;s+=2)scheduler["getEvent"+e[s+1]]=t(e[s]),scheduler["setEvent"+e[s+1]]=r(e[s])}(),scheduler.event_updated=function(e,t){this.is_visible_events(e)?this.render_view_data():this.clear_event(e.id)},scheduler.is_visible_events=function(e){var t=e.start_date<this._max_date&&this._min_date<e.end_date;if(t){var r=this._table_view||e.end_date.getHours()>=this.config.first_hour&&e.end_date.getHours()<this.config.last_hour||e.start_date.getHours()>=this.config.first_hour&&e.start_date.getHours()<this.config.last_hour;if(r)return!0;var s=(e.end_date.valueOf()-e.start_date.valueOf())/36e5,a=24-(this.config.last_hour-this.config.first_hour);return s>a}return!1},scheduler.isOneDayEvent=function(e){if(e.rec_type)return!0;var t=e.end_date.getDate()-e.start_date.getDate();return t?(0>t&&(t=Math.ceil((e.end_date.valueOf()-e.start_date.valueOf())/864e5)),1===t&&!e.end_date.getHours()&&!e.end_date.getMinutes()&&(e.start_date.getHours()||e.start_date.getMinutes())):e.start_date.getMonth()===e.end_date.getMonth()&&e.start_date.getFullYear()===e.end_date.getFullYear()},scheduler.get_visible_events=function(e){var t=[];for(var r in this._events)this.is_visible_events(this._events[r])&&(!e||this._events[r]._timed)&&this.filter_event(r,this._events[r])&&t.push(this._events[r]);return t},scheduler.filter_event=function(e,t){var r=this["filter_"+this._mode];return r?r(e,t):!0},scheduler._is_main_area_event=function(e){return!!e._timed},scheduler.render_view_data=function(e,t){if(!e){if(this._not_render)return void(this._render_wait=!0);this._render_wait=!1,this.clear_view(),e=this.get_visible_events(!(this._table_view||this.config.multi_day))}for(var r=0,s=e.length;s>r;r++)this._recalculate_timed(e[r]);if(this.config.multi_day&&!this._table_view){for(var a=[],i=[],r=0;r<e.length;r++)this._is_main_area_event(e[r])?a.push(e[r]):i.push(e[r]);this._rendered_location=this._els.sdr_multi_day[0],this._table_view=!0,this.render_data(i,t),this._table_view=!1,this._rendered_location=this._els.sdr_cal_data[0],this._table_view=!1,this.render_data(a,t)}else this._rendered_location=this._els.sdr_cal_data[0],this.render_data(e,t)},scheduler._view_month_day=function(e){var t=scheduler.getActionData(e).date;scheduler.callEvent("onViewMoreClick",[t])&&scheduler.setCurrentView(t,"day")},scheduler._render_month_link=function(e){for(var t=this._rendered_location,r=this._lame_clone(e),s=e._sday;s<e._eday;s++){r._sday=s,r._eday=s+1;var a=scheduler.date,i=scheduler._min_date;i=a.add(i,r._sweek,"week"),i=a.add(i,r._sday,"day");var n=scheduler.getEvents(i,a.add(i,1,"day")).length,d=this._get_event_bar_pos(r),l=d.x2-d.x,_=document.createElement("DIV");_.onclick=function(e){scheduler._view_month_day(e||event)},_.className="sdr_month_link",_.style.top=d.y+"px",_.style.left=d.x+"px",_.style.width=l+"px",_.innerHTML=scheduler.templates.month_events_link(i,n),this._rendered.push(_),t.appendChild(_)}},scheduler._recalculate_timed=function(e){if(e){var t;t="object"!=typeof e?this._events[e]:e,t&&(t._timed=scheduler.isOneDayEvent(t))}},scheduler.attachEvent("onEventChanged",scheduler._recalculate_timed),scheduler.attachEvent("onEventAdded",scheduler._recalculate_timed),scheduler.render_data=function(e,t){e=this._pre_render_events(e,t);for(var r=0;r<e.length;r++)if(this._table_view)if("month"!==scheduler._mode)this.render_event_bar(e[r]);else{var s=scheduler.config.max_month_events;s!==1*s||e[r]._sorder<s?this.render_event_bar(e[r]):void 0!==s&&e[r]._sorder===s&&scheduler._render_month_link(e[r])}else this.render_event(e[r])},scheduler._get_first_visible_cell=function(e){for(var t=0;t<e.length;t++)if(-1===(e[t].className||"").indexOf("sdr_scale_ignore"))return e[t];return e[0]},scheduler._pre_render_events=function(e,t){var r=this.xy.bar_height,s=this._colsS.heights,a=this._colsS.heights=[0,0,0,0,0,0,0],i=this._els.sdr_cal_data[0];if(e=this._table_view?this._pre_render_events_table(e,t):this._pre_render_events_line(e,t),this._table_view)if(t)this._colsS.heights=s;else{var n=i.firstChild;if(n.rows){for(var d=0;d<n.rows.length;d++){a[d]++;var l=n.rows[d].cells,_=this._colsS.height-this.xy.month_head_height;if(a[d]*r>_){var o=_;1*this.config.max_month_events!==this.config.max_month_events||a[d]<=this.config.max_month_events?o=a[d]*r:(this.config.max_month_events+1)*r>_&&(o=(this.config.max_month_events+1)*r);for(var c=0;c<l.length;c++)l[c].childNodes[1].style.height=o+"px"}a[d]=(a[d-1]||0)+scheduler._get_first_visible_cell(l).offsetHeight}if(a.unshift(0),n.parentNode.offsetHeight<n.parentNode.scrollHeight&&!scheduler._colsS.scroll_fix&&scheduler.xy.scroll_width){var h=scheduler._colsS,u=h[h.col_length],v=h.heights.slice();u-=scheduler.xy.scroll_width||0,this._calc_scale_sizes(u,this._min_date,this._max_date),scheduler._colsS.heights=v,this.set_xy(this._els.sdr_cal_header[0],u,this.xy.scale_height),scheduler._render_scales(this._els.sdr_cal_header[0]),scheduler._render_month_scale(this._els.sdr_cal_data[0],this._get_timeunit_start(),this._min_date),h.scroll_fix=!0}}else if(e.length||"visible"!==this._els.sdr_multi_day[0].style.visibility||(a[0]=-1),e.length||-1===a[0]){var f=(n.parentNode.childNodes,(a[0]+1)*r+1),g=f,m=f+"px";this.config.multi_day_height_limit&&(g=Math.min(f,this.config.multi_day_height_limit),m=g+"px"),i.style.top=this._els.sdr_cal_navline[0].offsetHeight+this._els.sdr_cal_header[0].offsetHeight+g+"px",i.style.height=this._obj.offsetHeight-parseInt(i.style.top,10)-(this.xy.margin_top||0)+"px";var p=this._els.sdr_multi_day[0];p.style.height=m,p.style.visibility=-1===a[0]?"hidden":"visible";var y=this._els.sdr_multi_day[1];y.style.height=m,y.style.visibility=-1===a[0]?"hidden":"visible",y.className=a[0]?"sdr_multi_day_icon":"sdr_multi_day_icon_small",this._dy_shift=(a[0]+1)*r,this.config.multi_day_height_limit&&(this._dy_shift=Math.min(this.config.multi_day_height_limit,this._dy_shift)),a[0]=0,g!==f&&(i.style.top=parseInt(i.style.top)+2+"px",p.style.overflowY="auto",y.style.position="fixed",y.style.top="",y.style.left="")}}return e},scheduler._get_event_sday=function(e){return Math.floor((e.start_date.valueOf()-this._min_date.valueOf())/864e5)},scheduler._get_event_mapped_end_date=function(e){var t=e.end_date;if(this.config.separate_short_events){var r=(e.end_date-e.start_date)/6e4;r<this._min_mapped_duration&&(t=this.date.add(t,this._min_mapped_duration-r,"minute"))}return t},scheduler._pre_render_events_line=function(e,t){e.sort(function(e,t){return e.start_date.valueOf()===t.start_date.valueOf()?e.id>t.id?1:-1:e.start_date>t.start_date?1:-1});var r=[],s=[];this._min_mapped_duration=Math.ceil(60*this.xy.min_event_height/this.config.hour_size_px);for(var a=0;a<e.length;a++){var i=e[a],n=i.start_date,d=i.end_date,l=n.getHours(),_=d.getHours();if(i._sday=this._get_event_sday(i),this._ignores[i._sday])e.splice(a,1),a--;else{if(r[i._sday]||(r[i._sday]=[]),!t){i._inner=!1;for(var o=r[i._sday];o.length;){var c=o[o.length-1],h=this._get_event_mapped_end_date(c);if(!(h.valueOf()<=i.start_date.valueOf()))break;o.splice(o.length-1,1)}for(var u=o.length,v=!1,f=0;f<o.length;f++){var c=o[f],h=this._get_event_mapped_end_date(c);if(h.valueOf()<=i.start_date.valueOf()){v=!0,i._sorder=c._sorder,u=f,i._inner=!0;break}}if(o.length&&(o[o.length-1]._inner=!0),!v)if(o.length)if(o.length<=o[o.length-1]._sorder){if(o[o.length-1]._sorder)for(f=0;f<o.length;f++){for(var g=!1,m=0;m<o.length;m++)if(o[m]._sorder===f){g=!0;break}if(!g){i._sorder=f;break}}else i._sorder=0;i._inner=!0}else{var p=o[0]._sorder;for(f=1;f<o.length;f++)o[f]._sorder>p&&(p=o[f]._sorder);i._sorder=p+1,i._inner=!1}else i._sorder=0;o.splice(u,u===o.length?0:1,i),o.length>(o.max_count||0)?(o.max_count=o.length,i._count=o.length):i._count=i._count?i._count:1}(l<this.config.first_hour||_>=this.config.last_hour)&&(s.push(i),e[a]=i=this._copy_event(i),l<this.config.first_hour&&(i.start_date.setHours(this.config.first_hour),i.start_date.setMinutes(0)),_>=this.config.last_hour&&(i.end_date.setMinutes(0),i.end_date.setHours(this.config.last_hour)),i.start_date>i.end_date||l===this.config.last_hour)&&(e.splice(a,1),a--)}}if(!t){for(var a=0;a<e.length;a++)e[a]._count=r[e[a]._sday].max_count;for(var a=0;a<s.length;a++)s[a]._count=r[s[a]._sday].max_count}return e},scheduler._time_order=function(e){e.sort(function(e,t){return e.start_date.valueOf()===t.start_date.valueOf()?e._timed&&!t._timed?1:!e._timed&&t._timed?-1:e.id>t.id?1:-1:e.start_date>t.start_date?1:-1})},scheduler._pre_render_events_table=function(e,t){this._time_order(e);for(var r,s=[],a=[[],[],[],[],[],[],[]],i=scheduler._colsS.heights,n=scheduler._cols.length,d={},l=0;l<e.length;l++){var _=e[l],o=_.id;d[o]||(d[o]={first_chunk:!0,last_chunk:!0});var c=d[o],h=r||_.start_date,u=_.end_date;h<this._min_date&&(c.first_chunk=!1,h=this._min_date),u>this._max_date&&(c.last_chunk=!1,u=this._max_date);var v=this.locate_holder_day(h,!1,_);if(_._sday=v%n,!this._ignores[_._sday]||!_._timed){var f=this.locate_holder_day(u,!0,_)||n;_._eday=f%n||n,_._length=f-v,_._sweek=Math.floor((this._correct_shift(h.valueOf(),1)-this._min_date.valueOf())/(864e5*n));var g,m=a[_._sweek];for(g=0;g<m.length&&!(m[g]._eday<=_._sday);g++);if(_._sorder&&t||(_._sorder=g),_._sday+_._length<=n)r=null,s.push(_),m[g]=_,i[_._sweek]=m.length-1,_._first_chunk=c.first_chunk,_._last_chunk=c.last_chunk;else{var p=this._copy_event(_);p.id=_.id,p._length=n-_._sday,p._eday=n,p._sday=_._sday,p._sweek=_._sweek,p._sorder=_._sorder,p.end_date=this.date.add(h,p._length,"day"),p._first_chunk=c.first_chunk,c.first_chunk&&(c.first_chunk=!1),s.push(p),m[g]=p,r=p.end_date,i[_._sweek]=m.length-1,l--}}}return s},scheduler._copy_dummy=function(){var e=new Date(this.start_date),t=new Date(this.end_date);this.start_date=e,this.end_date=t,this.event_length=this.event_pid=this.rec_pattern=this.rec_type=null},scheduler._copy_event=function(e){return this._copy_dummy.prototype=e,new this._copy_dummy},scheduler._rendered=[],scheduler.clear_view=function(){for(var e=0;e<this._rendered.length;e++){var t=this._rendered[e];t.parentNode&&t.parentNode.removeChild(t)}this._rendered=[]},scheduler.updateEvent=function(e){var t=this.getEvent(e);t&&t.rec_type&&(t.rec_pattern=(t.rec_type||"").split("#")[0]),t&&t.rec_type&&!this._is_virtual_event(e)?scheduler.update_view():(this.clear_event(e),t&&this.is_visible_events(t)&&this.filter_event(e,t)&&(this._table_view||this.config.multi_day||t._timed)&&(this.config.update_render?this.render_view_data():"month"!==this.getState().mode||this.getState().drag_id||this.isOneDayEvent(t)?this.render_view_data([t],!0):this.render_view_data()))},scheduler.clear_event=function(e){this.for_rendered(e,function(e,t){e.parentNode&&e.parentNode.removeChild(e),scheduler._rendered.splice(t,1)})},scheduler._y_from_date=function(e){var t=60*e.getHours()+e.getMinutes();return Math.round((60*t*1e3-60*this.config.first_hour*60*1e3)*this.config.hour_size_px/36e5)%(24*this.config.hour_size_px)},scheduler._calc_event_y=function(e,t){t=t||0;var r=60*e.start_date.getHours()+e.start_date.getMinutes(),s=60*e.end_date.getHours()+e.end_date.getMinutes()||60*scheduler.config.last_hour,a=this._y_from_date(e.start_date),i=Math.max(t,(s-r)*this.config.hour_size_px/60);return{top:a,height:i}},scheduler.render_event=function(e){var t=scheduler.xy.menu_width,r=this.config.use_select_menu_space?0:t;if(!(e._sday<0)){var s=scheduler.locate_holder(e._sday);if(s){var a=this._calc_event_y(e,scheduler.xy.min_event_height),i=a.top,n=a.height,d=e._count||1,l=e._sorder||0,_=Math.floor((s.clientWidth-r)/d),o=l*_+1;if(e._inner||(_*=d-l),this.config.cascade_event_display){var c=this.config.cascade_event_count,h=this.config.cascade_event_margin;o=l%c*h;var u=e._inner?(d-l-1)%c*h/2:0;_=Math.floor(s.clientWidth-r-o-u)}var v=this._render_v_bar(e,r+o,i,_,n,e._text_style,scheduler.templates.event_header(e.start_date,e.end_date,e),scheduler.templates.event_text(e.start_date,e.end_date,e));if(this._rendered.push(v),s.appendChild(v),o=o+parseInt(s.style.left,10)+r,this._edit_id===e.id){v.style.zIndex=1,_=Math.max(_-4,scheduler.xy.editor_width),v=document.createElement("DIV"),v.setAttribute("data-event-id",e.id),this.set_xy(v,_,n-20,o,i+14),v.className="sdr_cal_event sdr_cal_editor";var f=scheduler.templates.event_class(e.start_date,e.end_date,e);f&&(v.className+=" "+f);var g=document.createElement("DIV");this.set_xy(g,_-6,n-26),g.style.cssText+=";margin:2px 2px 2px 2px;overflow:hidden;",v.appendChild(g),this._els.sdr_cal_data[0].appendChild(v),this._rendered.push(v),g.innerHTML="<textarea class='sdr_cal_editor'>"+e.text+"</textarea>",this._quirks7&&(g.firstChild.style.height=n-12+"px"),this._editor=g.firstChild,this._editor.onkeydown=function(e){if((e||event).shiftKey)return!0;var t=(e||event).keyCode;t===scheduler.keys.edit_save&&scheduler.editStop(!0),t===scheduler.keys.edit_cancel&&scheduler.editStop(!1)},this._editor.onselectstart=function(e){return(e||event).cancelBubble=!0,!0},scheduler._focus(g.firstChild,!0),this._els.sdr_cal_data[0].scrollLeft=0}if(0!==this.xy.menu_width&&this._select_id===e.id){this.config.cascade_event_display&&this._drag_mode&&(v.style.zIndex=1);for(var m=this.config["icons_"+(this._edit_id===e.id?"edit":"select")],p="",y=e.color?"background-color : "+e.color+";":"",b=e.textColor?"color : "+e.textColor+";":"",x=0;x<m.length;x++)p+="<div class='sdr_menu_icon "+m[x]+"' style='"+y+b+"' title='"+this.locale.labels[m[x]]+"'></div>";var w=this._render_v_bar(e,o-t+1,i,t,20*m.length+26-2,"","<div style='"+y+b+"' class='sdr_menu_head'></div>",p,!0);w.style.left=o-t+1,this._els.sdr_cal_data[0].appendChild(w),this._rendered.push(w)}this.config.drag_highlight&&this._drag_id===e.id&&this.highlightEventPosition(e)}}},scheduler._render_v_bar=function(e,t,r,s,a,i,n,d,l){var _=document.createElement("DIV"),o=e.id,c=l?"sdr_cal_event sdr_cal_select_menu":"sdr_cal_event",h=scheduler.templates.event_class(e.start_date,e.end_date,e);h&&(c=c+" "+h);var u=e.color?"background:"+e.color+";":"",v=e.textColor?"color:"+e.textColor+";":"",f='<div data-event-id="'+o+'" class="'+c+'" style="position:absolute; top:'+r+"px; left:"+t+"px; width:"+(s-4)+"px; height:"+a+"px;"+(i||"")+'"></div>';_.innerHTML=f;var g=_.cloneNode(!0).firstChild;if(!l&&scheduler.renderEvent(g,e,s,a,n,d))return g;g=_.firstChild;var m='<div class="sdr_event_move sdr_header" style=" width:'+(s-6)+"px;"+u+'" >&nbsp;</div>';m+='<div class="sdr_event_move sdr_title" style="'+u+v+'">'+n+"</div>",m+='<div class="sdr_body" style=" width:'+(s-(this._quirks?4:14))+"px; height:"+(a-(this._quirks?20:30)+1)+"px;"+u+v+'">'+d+"</div>";var p="sdr_event_resize sdr_footer";return l&&(p="sdr_resize_denied "+p),m+='<div class="'+p+'" style=" width:'+(s-8)+"px;"+(l?" margin-top:-1px;":"")+u+v+'" ></div>',g.innerHTML=m,g},scheduler.renderEvent=function(){return!1},scheduler.locate_holder=function(e){return"day"===this._mode?this._els.sdr_cal_data[0].firstChild:this._els.sdr_cal_data[0].childNodes[e]},scheduler.locate_holder_day=function(e,t){var r=Math.floor((this._correct_shift(e,1)-this._min_date)/864e5);return t&&this.date.time_part(e)&&r++,r},scheduler._get_dnd_order=function(e,t,r){if(!this._drag_event)return e;this._drag_event._orig_sorder?e=this._drag_event._orig_sorder:this._drag_event._orig_sorder=e;for(var s=t*e;s+t>r;)e--,s-=t;return e=Math.max(e,0)},scheduler._get_event_bar_pos=function(e){var t=this._colsS[e._sday],r=this._colsS[e._eday];r===t&&(r=this._colsS[e._eday+1]);var s=this.xy.bar_height,a=e._sorder;if(e.id===this._drag_id){var i=this._colsS.heights[e._sweek+1]-this._colsS.heights[e._sweek]-this.xy.month_head_height;a=scheduler._get_dnd_order(a,s,i)}var n=a*s,d=this._colsS.heights[e._sweek]+(this._colsS.height?this.xy.month_scale_height+2:2)+n;return{x:t,x2:r,y:d}},scheduler.render_event_bar=function(e){var t=this._rendered_location,r=this._get_event_bar_pos(e),s=r.y,a=r.x,i=r.x2,n="";if(i){var d=scheduler.config.resize_month_events&&"month"===this._mode&&(!e._timed||scheduler.config.resize_month_timed),l=document.createElement("DIV"),_=e.hasOwnProperty("_first_chunk")&&e._first_chunk,o=e.hasOwnProperty("_last_chunk")&&e._last_chunk,c=d&&(e._timed||_),h=d&&(e._timed||o),u="sdr_cal_event_clear";(!e._timed||d)&&(u="sdr_cal_event_line"),_&&(u+=" sdr_cal_event_line_start"),o&&(u+=" sdr_cal_event_line_end"),c&&(n+="<div class='sdr_event_resize sdr_event_resize_start'></div>"),h&&(n+="<div class='sdr_event_resize sdr_event_resize_end'></div>");var v=scheduler.templates.event_class(e.start_date,e.end_date,e);v&&(u+=" "+v);var f=e.color?"background:"+e.color+";":"",g=e.textColor?"color:"+e.textColor+";":"",m=["position:absolute","top:"+s+"px","left:"+a+"px","width:"+(i-a-15)+"px",g,f,e._text_style||""].filter(String).join(";"),p='<div data-event-id="'+e.id+'" class="'+u+'" style="'+m+'">';d&&(p+=n),"month"===scheduler.getState().mode&&(e=scheduler.getEvent(e.id)),(e._timed||e.oneday)&&(p+=scheduler.templates.event_bar_date(e.start_date,e.end_date,e)),p+=scheduler.templates.event_bar_text(e.start_date,e.end_date,e)+"</div>",p+="</div>",l.innerHTML=p,this._rendered.push(l.firstChild),t.appendChild(l.firstChild)}},scheduler._locate_event=function(e){for(var t=null;e&&!t&&e.getAttribute;)t=e.getAttribute("data-event-id"),e=e.parentNode;return t},scheduler.edit=function(e){this._edit_id!==e&&(this.editStop(!1,e),this._edit_id=e,this.updateEvent(e))},scheduler.editStop=function(e,t){if(!t||this._edit_id!==t){var r=this.getEvent(this._edit_id);r&&(e&&(r.text=this._editor.value),this._edit_id=null,this._editor=null,this.updateEvent(r.id),this._edit_stop_event(r,e))}},scheduler._edit_stop_event=function(e,t){this._new_event?(t?this.callEvent("onEventAdded",[e.id,e]):e&&this.deleteEvent(e.id,!0),this._new_event=null):t&&this.callEvent("onEventChanged",[e.id,e])},scheduler.getEvents=function(e,t){var r=[];for(var s in this._events){var a=this._events[s];a&&(!e&&!t||a.start_date<t&&a.end_date>e)&&r.push(a)}return r},scheduler.getRenderedEvent=function(e){if(e){for(var t=scheduler._rendered,r=0;r<t.length;r++){var s=t[r];if(s.getAttribute("data-event-id")===e)return s}return null}},scheduler.showEvent=function(e,t){var r="number"==typeof e||"string"==typeof e?scheduler.getEvent(e):e;if(t=t||scheduler._mode,r&&(!this.checkEvent("onBeforeEventDisplay")||this.callEvent("onBeforeEventDisplay",[r,t]))){var s=scheduler.config.scroll_hour;scheduler.config.scroll_hour=r.start_date.getHours();var a=scheduler.config.preserve_scroll;scheduler.config.preserve_scroll=!1;var i=r.color,n=r.textColor;scheduler.config.highlight_displayed_event&&(r.color=scheduler.config.displayed_event_color,r.textColor=scheduler.config.displayed_event_text_color),scheduler.setCurrentView(new Date(r.start_date),t),r.color=i,r.textColor=n,scheduler.config.scroll_hour=s,scheduler.config.preserve_scroll=a,scheduler.matrix&&scheduler.matrix[t]&&(scheduler._els.sdr_cal_data[0].scrollTop=getAbsoluteTop(scheduler.getRenderedEvent(r.id))-getAbsoluteTop(scheduler._els.sdr_cal_data[0])-20),scheduler.callEvent("onAfterEventDisplay",[r,t])}},scheduler._append_drag_marker=function(e){if(!e.parentNode){var t=scheduler._els.sdr_cal_data[0],r=t.lastChild;r.className&&r.className.indexOf("sdr_scale_holder")<0&&r.previousSibling&&(r=r.previousSibling),r&&0===r.className.indexOf("sdr_scale_holder")&&r.appendChild(e)}},scheduler._update_marker_position=function(e,t){var r=scheduler._calc_event_y(t,0);e.style.top=r.top+"px",e.style.height=r.height+"px"},scheduler.highlightEventPosition=function(e){var t=document.createElement("DIV");t.setAttribute("data-event-id",e.id),this._rendered.push(t),this._update_marker_position(t,e);var r=this.templates.drag_marker_class(e.start_date,e.end_date,e),s=this.templates.drag_marker_content(e.start_date,e.end_date,e);t.className="sdr_drag_marker",r&&(t.className+=" "+r),s&&(t.innerHTML=s),this._append_drag_marker(t)},scheduler._loaded={},scheduler._load=function(e,t){if(e=e||this._load_url){e+=(-1===e.indexOf("?")?"?":"&")+"timeshift="+(new Date).getTimezoneOffset(),this.config.prevent_cache&&(e+="&uid="+this.uid());var r;if(t=t||this._date,this._load_mode){var s=this.templates.load_format;for(t=this.date[this._load_mode+"_start"](new Date(t.valueOf()));t>this._min_date;)t=this.date.add(t,-1,this._load_mode);r=t;for(var a=!0;r<this._max_date;)r=this.date.add(r,1,this._load_mode),this._loaded[s(t)]&&a?t=this.date.add(t,1,this._load_mode):a=!1;var i=r;do r=i,i=this.date.add(r,-1,this._load_mode);while(i>t&&this._loaded[s(i)]);if(t>=r)return!1;for(Scheduler.util.ajax.get(e+"&from="+s(t)+"&to="+s(r),function(e){scheduler.on_load(e)});r>t;)this._loaded[s(t)]=!0,t=this.date.add(t,1,this._load_mode)}else Scheduler.util.ajax.get(e,function(e){scheduler.on_load(e)});return this.callEvent("onDataLoaderStart",[]),!0}},scheduler.on_load=function(e){var t,r=!1;try{t=this.json.parse(e.xmlDoc.responseText)}catch(s){r=!0}r&&(this.callEvent("onLoadError",[e.xmlDoc]),t=[]),scheduler._process_loading(t),this.callEvent("onDataLoaderEnd",[])},scheduler._process_loading=function(e){this._loading=!0,this._not_render=!0;for(var t,r=0;r<e.length;r++)if(t=e[r],this.callEvent("onEventLoading",[e[r]])){if(t.date_start){t.start_date=t.date_start.y+"/"+t.date_start.m+"/"+t.date_start.d+" "+t.date_start.ho+":"+t.date_start.mi+":"+t.date_start.se,t.end_date=t.date_end.y+"/"+t.date_end.m+"/"+t.date_end.d+" "+t.date_end.ho+":"+t.date_end.mi+":"+t.date_end.se,t.changed=t.date_changed,t.oversea="KR"!==t.info.addr_place_of_delivery.cd$country,t.text="";var s=[];"release"===t.type?s.push(t.info.nm$partner_buyer):"departure"===t.type?s.push(t.info.nm$partner_buyer):"wearing"===t.type&&s.push(t.info.nm$partner_supplier),s.push(t.info.nm$trade_terms),s.push(t.info.nm$category_delivery_type),s.push(t.info.addr_place_of_delivery.f),t.text=s.join(" / "),delete t.date_start,delete t.date_end,delete t.date_changed}this.addEvent(t)}this._not_render=!1,this._render_wait&&this.render_view_data(),this._loading=!1,this._after_call&&this._after_call(),this._after_call=null},scheduler._init_event=function(e){e.text=e.text||e._tagvalue||"",e.start_date=scheduler._init_date(e.start_date),e.end_date=scheduler._init_date(e.end_date)},scheduler._init_date=function(e){return e?"string"==typeof e?scheduler.templates.xml_date(e):new Date(e):null},scheduler.json={},scheduler.json.parse=function(data){"string"==typeof data&&(scheduler._temp=eval("("+data+")"),data=scheduler._temp?scheduler._temp:[]);for(var evs=[],i=0;i<data.length;i++){var event=data[i];scheduler._init_event(event),evs.push(event)}return evs},scheduler.load=function(e,t){if("string"==typeof e)this._load_url=e,this._after_call=t,this._load(e,this._date);else{var r={xmlDoc:{responseText:e}};this._after_call=t,this.on_load(r)}},scheduler.setLoadMode=function(e){"all"===e&&(e=""),this._load_mode=e},scheduler._xmlNodeToJSON=function(e){for(var t={},r=0;r<e.attributes.length;r++)t[e.attributes[r].name]=e.attributes[r].value;for(var r=0;r<e.childNodes.length;r++){var s=e.childNodes[r];1===s.nodeType&&(t[s.tagName]=s.firstChild?s.firstChild.nodeValue:"")}return t.text||(t.text=e.firstChild?e.firstChild.nodeValue:""),t},scheduler.attachEvent("onDataLoaderStart",function(){if(this.config.show_loading===!0){var e;e=this.config.show_loading=document.createElement("DIV"),e.className="sdr_loading",e.style.left=Math.round((this._x-128)/2)+"px",e.style.top=Math.round((this._y-15)/2)+"px",this._obj.appendChild(e)}}),scheduler.attachEvent("onDataLoaderEnd",function(){var e=this.config.show_loading;e&&"object"==typeof e&&(this._obj.removeChild(e),this.config.show_loading=!0)}),scheduler._lightbox_controls={},scheduler.formSection=function(e){var t=this.config.lightbox.sections,r=0;for(r;r<t.length&&t[r].name!==e;r++);var s=t[r];scheduler._lightbox||scheduler.getLightbox();var a=document.getElementById(s.id),i=a.nextSibling,n={section:s,header:a,node:i,getValue:function(e){return scheduler.form_blocks[s.type].get_value(i,e||{},s)},setValue:function(e,t){return scheduler.form_blocks[s.type].set_value(i,e,t||{},s)}},d=scheduler._lightbox_controls["get_"+s.type+"_control"];return d?d(n):n},scheduler._lightbox_controls.get_template_control=function(e){return e.control=e.node,e},scheduler._lightbox_controls.get_select_control=function(e){return e.control=e.node.getElementsByTagName("select")[0],e},scheduler._lightbox_controls.get_textarea_control=function(e){return e.control=e.node.getElementsByTagName("textarea")[0],e},scheduler._lightbox_controls.get_time_control=function(e){return e.control=e.node.getElementsByTagName("select"),e},scheduler.form_blocks={template:{render:function(e){var t=(e.height||"30")+"px";return"<div class='sdr_cal_ltext sdr_cal_template' style='height:"+t+";'></div>"},set_value:function(e,t,r,s){e.innerHTML=t||""},get_value:function(e,t,r){return e.innerHTML||""},focus:function(e){}},textarea:{render:function(e){var t=(e.height||"130")+"px";return"<div class='sdr_cal_ltext' style='height:"+t+";'><textarea></textarea></div>"},set_value:function(e,t,r){e.firstChild.value=t||""},get_value:function(e,t){return e.firstChild.value},focus:function(e){var t=e.firstChild;scheduler._focus(t,!0)}},select:{render:function(e){for(var t=(e.height||"23")+"px",r="<div class='sdr_cal_ltext' style='height:"+t+";'><select style='width:100%;'>",s=0;s<e.options.length;s++)r+="<option value='"+e.options[s].key+"'>"+e.options[s].label+"</option>";return r+="</select></div>"},set_value:function(e,t,r,s){var a=e.firstChild;!a._sdr_onchange&&s.onchange&&(a.onchange=s.onchange,a._sdr_onchange=!0),"undefined"==typeof t&&(t=(a.options[0]||{}).value),a.value=t||""},get_value:function(e,t){return e.firstChild.value},focus:function(e){var t=e.firstChild;scheduler._focus(t,!0)}},time:{render:function(e){e.time_format||(e.time_format=["%Y","%m","%d","%H:%i"]),e._time_format_order={};var t=e.time_format,r=scheduler.config,s=this.date.date_part(scheduler._currentDate()),a=1440,i=0;scheduler.config.limit_time_select&&(a=60*r.last_hour+1,i=60*r.first_hour,s.setHours(r.first_hour));for(var n="",d=0;d<t.length;d++){var l=t[d];switch(d>0&&(n+=" "),l){case"%Y":e._time_format_order[3]=d,n+="<select>";for(var _=s.getFullYear()-5,o=0;10>o;o++)n+="<option value='"+(_+o)+"'>"+(_+o)+"</option>";n+="</select> ";break;case"%m":e._time_format_order[2]=d,n+="<select>";for(var o=0;12>o;o++)n+="<option value='"+o+"'>"+this.locale.date.month_full[o]+"</option>";n+="</select>";break;case"%d":e._time_format_order[1]=d,n+="<select>";for(var o=1;32>o;o++)n+="<option value='"+o+"'>"+o+"</option>";n+="</select>";break;case"%H:%i":e._time_format_order[0]=d,n+="<select>";var o=i,c=s.getDate();for(e._time_values=[];a>o;){var h=this.templates.time_picker(s);n+="<option value='"+o+"'>"+h+"</option>",e._time_values.push(o),s.setTime(s.valueOf()+60*this.config.time_step*1e3);var u=s.getDate()!==c?1:0;o=24*u*60+60*s.getHours()+s.getMinutes()}n+="</select>"}}return"<div style='height:30px;padding-top:0px;font-size:inherit;' class='sdr_section_time'>"+n+"<span style='font-weight:normal; font-size:10pt;'> ~ </span>"+n+"</div>"},set_value:function(e,t,r,s){function a(e,t,r){for(var a=s._time_values,i=60*r.getHours()+r.getMinutes(),n=i,d=!1,l=0;l<a.length;l++){var o=a[l];if(o===i){d=!0;break}i>o&&(n=o)}e[t+_[0]].value=d?i:n,d||n||(e[t+_[0]].selectedIndex=-1),e[t+_[1]].value=r.getDate(),e[t+_[2]].value=r.getMonth(),e[t+_[3]].value=r.getFullYear()}var i,n,d=scheduler.config,l=e.getElementsByTagName("select"),_=s._time_format_order;if(d.full_day){if(!e._full_day){var o="<label class='sdr_fullday'><input type='checkbox' name='full_day' value='true'> "+scheduler.locale.labels.full_day+"</label></input>";scheduler.config.wide_form||(o=e.previousSibling.innerHTML+o),e.previousSibling.innerHTML=o,e._full_day=!0}var c=e.previousSibling.getElementsByTagName("input")[0];c.checked=0===scheduler.date.time_part(r.start_date)&&0===scheduler.date.time_part(r.end_date),l[_[0]].disabled=c.checked,l[_[0]+l.length/2].disabled=c.checked,c.onclick=function(){if(c.checked){var t={};scheduler.form_blocks.time.get_value(e,t,s),i=scheduler.date.date_part(t.start_date),n=scheduler.date.date_part(t.end_date),(+n===+i||+n>=+i&&(0!==r.end_date.getHours()||0!==r.end_date.getMinutes()))&&(n=scheduler.date.add(n,1,"day"))}else i=null,n=null;l[_[0]].disabled=c.checked,l[_[0]+l.length/2].disabled=c.checked,a(l,0,i||r.start_date),a(l,4,n||r.end_date)}}if(d.auto_end_date&&d.event_duration)for(var h=function(){i=new Date(l[_[3]].value,l[_[2]].value,l[_[1]].value,0,l[_[0]].value),n=new Date(i.getTime()+60*scheduler.config.event_duration*1e3),a(l,4,n)},u=0;4>u;u++)l[u].onchange=h;a(l,0,r.start_date),a(l,4,r.end_date)},get_value:function(e,t,r){var s=e.getElementsByTagName("select"),a=r._time_format_order;if(t.start_date=new Date(s[a[3]].value,s[a[2]].value,s[a[1]].value,0,s[a[0]].value),t.end_date=new Date(s[a[3]+4].value,s[a[2]+4].value,s[a[1]+4].value,0,s[a[0]+4].value),!s[a[3]].value||!s[a[3]+4].value){var i=this.getEvent(this._lightbox_id);i&&(t.start_date=i.start_date,t.end_date=i.end_date)}return t.end_date<=t.start_date&&(t.end_date=scheduler.date.add(t.start_date,scheduler.config.time_step,"minute")),{start_date:new Date(t.start_date),end_date:new Date(t.end_date)}},focus:function(e){scheduler._focus(e.getElementsByTagName("select")[0])}}},scheduler.showCover=function(e){if(e){e.style.display="block";var t=window.pageYOffset||document.body.scrollTop||document.documentElement.scrollTop,r=window.pageXOffset||document.body.scrollLeft||document.documentElement.scrollLeft,s=window.innerHeight||document.documentElement.clientHeight;t?e.style.top=Math.round(t+Math.max((s-e.offsetHeight)/2,0))+"px":e.style.top=Math.round(Math.max((s-e.offsetHeight)/2,0)+9)+"px",document.documentElement.scrollWidth>document.body.offsetWidth?e.style.left=Math.round(r+(document.body.offsetWidth-e.offsetWidth)/2)+"px":e.style.left=Math.round((document.body.offsetWidth-e.offsetWidth)/2)+"px"}this.show_cover()},scheduler.showLightbox=function(e){if(e){if(!this.callEvent("onBeforeLightbox",[e]))return void(this._new_event&&(this._new_event=null));var t=this.getLightbox();this.showCover(t),this._fill_lightbox(e,t),this.callEvent("onLightbox",[e])}},scheduler._fill_lightbox=function(e,t){var r=this.getEvent(e),s=t.getElementsByTagName("span");scheduler.templates.lightbox_header?(s[1].innerHTML="",s[2].innerHTML=scheduler.templates.lightbox_header(r.start_date,r.end_date,r)):(s[1].innerHTML=this.templates.event_header(r.start_date,r.end_date,r),s[2].innerHTML=(this.templates.event_bar_text(r.start_date,r.end_date,r)||"").substr(0,70));for(var a=this.config.lightbox.sections,i=0;i<a.length;i++){var n=a[i],d=document.getElementById(n.id).nextSibling,l=this.form_blocks[n.type],_=void 0!==r[n.map_to]?r[n.map_to]:n.default_value;l.set_value.call(this,d,_,r,n),a[i].focus&&l.focus.call(this,d)}scheduler._lightbox_id=e},scheduler._lightbox_out=function(e){for(var t=this.config.lightbox.sections,r=0;r<t.length;r++){var s=document.getElementById(t[r].id);s=s?s.nextSibling:s;var a=this.form_blocks[t[r].type],i=a.get_value.call(this,s,e,t[r]);"auto"!==t[r].map_to&&(e[t[r].map_to]=i)}return e},scheduler._empty_lightbox=function(e){var t=scheduler._lightbox_id,r=this.getEvent(t);this.getLightbox();this._lame_copy(r,e),this.setEvent(r.id,r),this._edit_stop_event(r,!0),this.render_view_data()},scheduler.hide_lightbox=function(e){this.hideCover(this.getLightbox()),this._lightbox_id=null,this.callEvent("onAfterLightbox",[])},scheduler.hideCover=function(e){e&&(e.style.display="none"),this.hide_cover()},scheduler.hide_cover=function(){this._cover&&this._cover.parentNode.removeChild(this._cover),this._cover=null},scheduler.show_cover=function(){if(!this._cover){this._cover=document.createElement("DIV"),this._cover.className="sdr_cal_cover";var e=void 0!==document.height?document.height:document.body.offsetHeight,t=document.documentElement?document.documentElement.scrollHeight:0;this._cover.style.height=Math.max(e,t)+"px",document.body.appendChild(this._cover)}},scheduler.save_lightbox=function(){var e=this._lightbox_out({},this._lame_copy(this.getEvent(this._lightbox_id)));(!this.checkEvent("onEventSave")||this.callEvent("onEventSave",[this._lightbox_id,e,this._new_event]))&&(this._empty_lightbox(e),this.hide_lightbox())},scheduler.startLightbox=function(e,t){this._lightbox_id=e,this._custom_lightbox=!0,this._temp_lightbox=this._lightbox,this._lightbox=t,this.showCover(t)},scheduler.endLightbox=function(e,t){this._edit_stop_event(scheduler.getEvent(this._lightbox_id),e),e&&scheduler.render_view_data(),this.hideCover(t),this._custom_lightbox&&(this._lightbox=this._temp_lightbox,this._custom_lightbox=!1),this._temp_lightbox=this._lightbox_id=null},scheduler.removeLightbox=function(){scheduler._lightbox&&!scheduler._custom_lightbox&&scheduler._lightbox.parentNode.removeChild(scheduler._lightbox),scheduler._lightbox=null},scheduler.cancel_lightbox=function(){this.callEvent("onEventCancel",[this._lightbox_id,this._new_event]),this.endLightbox(!1),this.hide_lightbox()},scheduler._init_lightbox_events=function(){this.getLightbox().onclick=function(e){var t=e?e.target:event.srcElement;if(t.className||(t=t.previousSibling),t&&t.className)switch(t.className){case"sdr_save_btn":scheduler.save_lightbox();break;case"sdr_delete_btn":var r=scheduler.locale.labels.confirm_deleting;scheduler._component_confirm(r,scheduler.locale.labels.title_confirm_deleting,function(){scheduler.deleteEvent(scheduler._lightbox_id),scheduler._new_event=null,scheduler.hide_lightbox()});break;case"sdr_cancel_btn":scheduler.cancel_lightbox();break;default:if(t.getAttribute("data-sdr-button"))scheduler.callEvent("onLightboxButton",[t.className,t,e]);else{var s,a,i;-1!==t.className.indexOf("sdr_custom_button")&&(-1!==t.className.indexOf("sdr_custom_button_")?(s=t.parentNode.getAttribute("data-index"),i=t.parentNode.parentNode):(s=t.getAttribute("data-index"),i=t.parentNode,t=t.firstChild)),s&&(a=scheduler.form_blocks[scheduler.config.lightbox.sections[s].type],a.button_click(s,t,i,i.nextSibling))}}},this.getLightbox().onkeydown=function(e){switch((e||event).keyCode){case scheduler.keys.edit_save:if((e||event).shiftKey)return;scheduler.save_lightbox();break;case scheduler.keys.edit_cancel:scheduler.cancel_lightbox()}}},scheduler.setLightboxSize=function(){var e=this._lightbox;if(e){var t=e.childNodes[1];t.style.height="0px",t.style.height=t.scrollHeight+"px",e.style.height=t.scrollHeight+scheduler.xy.lightbox_additional_height+"px",t.style.height=t.scrollHeight+"px"}},scheduler._init_dnd_events=function(){Scheduler.eventObject._attachDomEvent(document.body,"mousemove",scheduler._move_while_dnd),Scheduler.eventObject._attachDomEvent(document.body,"mouseup",scheduler._finish_dnd),scheduler._init_dnd_events=function(){}},scheduler._move_while_dnd=function(e){if(scheduler._dnd_start_lb){scheduler.sdr_unselectable||(document.body.className+=" sdr_unselectable",scheduler.sdr_unselectable=!0);var t=scheduler.getLightbox(),r=e&&e.target?[e.pageX,e.pageY]:[event.clientX,event.clientY];t.style.top=scheduler._lb_start[1]+r[1]-scheduler._dnd_start_lb[1]+"px",t.style.left=scheduler._lb_start[0]+r[0]-scheduler._dnd_start_lb[0]+"px"}},scheduler._ready_to_dnd=function(e){var t=scheduler.getLightbox();scheduler._lb_start=[parseInt(t.style.left,10),parseInt(t.style.top,10)],scheduler._dnd_start_lb=e&&e.target?[e.pageX,e.pageY]:[event.clientX,event.clientY]},scheduler._finish_dnd=function(){scheduler._lb_start&&(scheduler._lb_start=scheduler._dnd_start_lb=!1,document.body.className=document.body.className.replace(" sdr_unselectable",""),document.body.className||document.body.removeAttribute("class"),scheduler.sdr_unselectable=!1)},scheduler.getLightbox=function(){if(!this._lightbox){var e=document.createElement("DIV");e.className="sdr_cal_light",scheduler.config.wide_form&&(e.className+=" sdr_cal_light_wide"),scheduler.form_blocks.recurring&&(e.className+=" sdr_cal_light_rec"),/msie|MSIE 6/.test(navigator.userAgent)&&(e.className+=" sdr_ie6"),e.style.visibility="hidden";for(var t=this._lightbox_template,r=this.config.buttons_left,s=0;s<r.length;s++)t+="<div class='sdr_btn_set sdr_left_btn_set "+r[s]+"_set'><div data-sdr-button='1' class='"+r[s]+"'></div><div>"+scheduler.locale.labels[r[s]]+"</div></div>";r=this.config.buttons_right;for(var s=0;s<r.length;s++)t+="<div class='sdr_btn_set sdr_right_btn_set "+r[s]+"_set' style='float:right;'><div data-sdr-button='1' class='"+r[s]+"'></div><div>"+scheduler.locale.labels[r[s]]+"</div></div>";t+="</div>",e.innerHTML=t,scheduler.config.drag_lightbox&&(e.firstChild.onmousedown=scheduler._ready_to_dnd,e.firstChild.onselectstart=function(){return!1},e.firstChild.style.cursor="pointer",scheduler._init_dnd_events()),document.body.insertBefore(e,document.body.firstChild),this._lightbox=e;var a=this.config.lightbox.sections;t="";for(var s=0;s<a.length;s++){var i=this.form_blocks[a[s].type];if(i){a[s].id="area_"+this.uid();var n="";a[s].button&&(n="<div class='sdr_custom_button' data-index='"+s+"'><div class='sdr_custom_button_"+a[s].button+"'></div><div>"+this.locale.labels["button_"+a[s].button]+"</div></div>"),this.config.wide_form&&(t+="<div class='sdr_wrap_section'>");var d=this.locale.labels["section_"+a[s].name];"string"!=typeof d&&(d=a[s].name),t+="<div id='"+a[s].id+"' class='sdr_cal_lsection'>"+n+d+"</div>"+i.render.call(this,a[s]),t+="</div>"}}for(var l=e.getElementsByTagName("div"),s=0;s<l.length;s++){var _=l[s];if("sdr_cal_larea"===_.className){_.innerHTML=t;break}}this.setLightboxSize(),this._init_lightbox_events(this),e.style.display="none",e.style.visibility="visible"}return this._lightbox},scheduler.attachEvent("onEventIdChange",function(e,t){this._lightbox_id===e&&(this._lightbox_id=t)}),scheduler._lightbox_template="<div class='sdr_cal_ltitle'><span class='sdr_mark'>&nbsp;</span><span class='sdr_time'></span><span class='sdr_title'></span></div><div class='sdr_cal_larea'></div>",scheduler._init_touch_events=function(){"force"!==this.config.touch&&(this.config.touch=this.config.touch&&(-1!==navigator.userAgent.indexOf("Mobile")||-1!==navigator.userAgent.indexOf("iPad")||-1!==navigator.userAgent.indexOf("Android")||-1!==navigator.userAgent.indexOf("Touch"))),this.config.touch&&(this.xy.scroll_width=0,window.navigator.msPointerEnabled?(this._touch_events(["MSPointerMove","MSPointerDown","MSPointerUp"],function(e){return e.pointerType===e.MSPOINTER_TYPE_MOUSE?null:e},function(e){return!e||e.pointerType===e.MSPOINTER_TYPE_MOUSE}),this._obj.ondblclick=function(){}):this._touch_events(["touchmove","touchstart","touchend"],function(e){return e.touches&&e.touches.length>1?null:e.touches[0]?{target:e.target,pageX:e.touches[0].pageX,pageY:e.touches[0].pageY}:e},function(){return!1}))},scheduler._touch_events=function(e,t,r){function s(e,t,r){Scheduler.eventObject._attachDomEvent(e,t,function(e){return scheduler._is_lightbox_open()?!0:r(e)})}function a(e,t,r,s){if(e&&t){for(var a=e.target;a&&a!==scheduler._obj;)a=a.parentNode;if(a===scheduler._obj){var i=Math.abs(e.pageY-t.pageY),n=Math.abs(e.pageX-t.pageX);s>i&&n>r&&(!i||n/i>3)&&(e.pageX>t.pageX?scheduler._click.sdr_cal_next_button():scheduler._click.sdr_cal_prev_button())}}}function i(e){var t=scheduler.getState().drag_mode,r=scheduler.matrix?scheduler.matrix[scheduler._mode]:!1,s=scheduler.render_view_data;"create"===t&&r&&(scheduler.render_view_data=function(){for(var e=scheduler.getState().drag_id,t=scheduler.getEvent(e),s=r.y_property,a=scheduler.getEvents(t.start_date,t.end_date),i=0;i<a.length;i++)a[i][s]!==t[s]&&(a.splice(i,1),i--);t._sorder=a.length-1,t._count=a.length,this.render_data([t],scheduler.getState().mode)}),scheduler._on_mouse_move(e),"create"===t&&r&&(scheduler.render_view_data=s)}function n(e){scheduler._hide_global_tip(),o&&(scheduler._on_mouse_up(t(e||event)),scheduler._temp_touch_block=!1),scheduler._drag_id=null,scheduler._drag_mode=null,scheduler._drag_pos=null,clearTimeout(_),o=h=!1,c=!0}var d,l,_,o,c,h,u=0;s(document.body,e[0],function(e){if(!r(e)){if(o)return i(t(e)),scheduler._update_global_tip(),e.preventDefault&&e.preventDefault(),e.cancelBubble=!0,!1;if(l=t(e),h)return l?void((d.target!==l.target||Math.abs(d.pageX-l.pageX)>5||Math.abs(d.pageY-l.pageY)>5)&&(c=!0,clearTimeout(_))):void(c=!0)}}),s(this._els.sdr_cal_data[0],"scroll",n),s(this._els.sdr_cal_data[0],"touchcancel",n),s(this._els.sdr_cal_data[0],"contextmenu",function(e){return h?(e&&e.preventDefault&&e.preventDefault(),(e||event).cancelBubble=!0,!1):void 0}),s(this._els.sdr_cal_data[0],e[1],function(e){if(!r(e)){var s;if(o=c=!1,h=!0,scheduler._temp_touch_block=!0,s=l=t(e),!s)return void(c=!0);var a=new Date;if(!c&&!o&&250>a-u)return scheduler._click.sdr_cal_data(s),setTimeout(function(){scheduler._on_dbl_click(s)},50),e.preventDefault&&e.preventDefault(),e.cancelBubble=!0,scheduler._block_next_stop=!0,!1;if(u=a,!c&&!o&&scheduler.config.touch_drag){var i=scheduler._locate_event(document.activeElement),n=scheduler._locate_event(s.target),v=d?scheduler._locate_event(d.target):null;if(i&&n&&i===n&&i!==v)return e.preventDefault&&e.preventDefault(),e.cancelBubble=!0,scheduler._ignore_next_click=!1,scheduler._click.sdr_cal_data(s),d=s,!1;_=setTimeout(function(){o=!0;var e=d.target;e&&e.className&&-1!==e.className.indexOf("sdr_body")&&(e=e.previousSibling),scheduler._on_mouse_down(d,e),scheduler._drag_mode&&"create"!==scheduler._drag_mode&&scheduler.for_rendered(scheduler._drag_id,function(e,t){e.style.display="none",scheduler._rendered.splice(t,1)}),scheduler.config.touch_tip&&scheduler._show_global_tip(),scheduler._on_mouse_move(d)},scheduler.config.touch_drag),d=s}}}),s(this._els.sdr_cal_data[0],e[2],function(e){return r(e)?void 0:(o||a(d,l,200,100),o&&(scheduler._ignore_next_click=!0),n(e),scheduler._block_next_stop?(scheduler._block_next_stop=!1,e.preventDefault&&e.preventDefault(),e.cancelBubble=!0,!1):void 0)}),Scheduler.eventObject._attachDomEvent(document.body,e[2],n)},scheduler._show_global_tip=function(){scheduler._hide_global_tip();var e=scheduler._global_tip=document.createElement("DIV");e.className="sdr_global_tip",scheduler._update_global_tip(1),document.body.appendChild(e)},scheduler._update_global_tip=function(e){var t=scheduler._global_tip;if(t){var r="";if(scheduler._drag_id&&!e){var s=scheduler.getEvent(scheduler._drag_id);s&&(r="<div>"+(s._timed?scheduler.templates.event_header(s.start_date,s.end_date,s):scheduler.templates.day_date(s.start_date,s.end_date,s))+"</div>")}"create"===scheduler._drag_mode||"new-size"===scheduler._drag_mode?t.innerHTML=(scheduler.locale.drag_to_create||"Drag to create")+r:t.innerHTML=(scheduler.locale.drag_to_move||"Drag to move")+r}},scheduler._hide_global_tip=function(){var e=scheduler._global_tip;e&&e.parentNode&&(e.parentNode.removeChild(e),scheduler._global_tip=0)},scheduler._skin_init=function(){scheduler.templates.event_bar_date=function(e,t,r){return r.changed?"‣ ":"• "},scheduler.attachEvent("onTemplatesReady",function(){var e=scheduler.date.date_to_str("%d");scheduler.templates._old_month_day||(scheduler.templates._old_month_day=scheduler.templates.month_day);var t=scheduler.templates._old_month_day;if(scheduler.templates.month_day=function(r){if("month"===this._mode){var s=e(r);return 1===r.getDate()&&(s=scheduler.locale.date.month_full[r.getMonth()]+" "+s),+r===+scheduler.date.date_part(new Date)&&(s=scheduler.locale.labels.sdr_cal_today_button+" "+s),s}return t.call(this,r)},scheduler.config.fix_tab_position)for(var r=scheduler._els.sdr_cal_navline[0].getElementsByTagName("div"),s=258,a=0;a<r.length;a++){var i=r[a],n=i.getAttribute("data-name");if(n)switch(i.style.right="auto",n){case"day_tab":i.style.left="14px",i.className+=" sdr_cal_tab_first";break;case"week_tab":i.style.left="75px";break;case"month_tab":i.style.left="136px";break;case"year_tab":i.style.left="197px";break;case"list_tab":i.style.left="258px",i.className+=" sdr_cal_tab_last";break;default:i.style.left=s+"px",i.className+=" sdr_cal_tab_standalone",s=s+14+i.offsetWidth}}}),scheduler._skin_init=function(){}},scheduler.form_blocks.recurring={_get_node:function(e){return"string"==typeof e&&(e=document.getElementById(e)),"none"===e.style.display&&(e.style.display=""),e},_outer_html:function(e){function t(e){var t,r=document.createElement("DIV");return r.appendChild(e.cloneNode(!0)),t=r.innerHTML,r=null,t}return e.outerHTML||t(e)},render:function(e){if(e.form){var t=scheduler.form_blocks.recurring,r=t._get_node(e.form),s=t._outer_html(r);return r.style.display="none",s}return scheduler.__recurring_template},_ds:{},_get_form_node:function(e,t,r){var s=e[t];if(!s)return null;if(s.nodeName)return s;if(s.length)for(var a=0;a<s.length;a++)if(s[a].value===r)return s[a]},_get_node_value:function(e,t,r){var s=e[t];if(!s)return"";if(s.length){if(r){for(var a=[],i=0;i<s.length;i++)s[i].checked&&a.push(s[i].value);return a}for(var i=0;i<s.length;i++)if(s[i].checked)return s[i].value}return s.value?r?[s.value]:s.value:void 0},_set_node_value:function(e,t,r){var s=e[t];if(s)if(s.name===t)s.value=r;else if(s.length)for(var a="object"==typeof r,i=0;i<s.length;i++)(a||s[i].value===r)&&(s[i].checked=a?!!r[s[i].value]:!!r)},_init_set_value:function(e,t,r){function s(e){for(var t=0;t<e.length;t++){var r=e[t];if(r.name)if(g[r.name])if(g[r.name].nodeType){var s=g[r.name];g[r.name]=[s,r]}else g[r.name].push(r);else g[r.name]=r}}function a(){p("sdr_repeat_day").style.display="none",p("sdr_repeat_week").style.display="none",p("sdr_repeat_month").style.display="none",p("sdr_repeat_year").style.display="none",p("sdr_repeat_"+this.value).style.display="block",scheduler.setLightboxSize()}function i(e){var t=[o(g,"repeat")];for(y[t[0]](t,e);t.length<5;)t.push("");var r="",s=n(g);if("no"===s)e.end=new Date(9999,1,1),r="no";else if("date_of_end"===s)e.end=u(o(g,"date_of_end"));else{scheduler.transpose_type(t.join("_")),r=Math.max(1,o(g,"occurences_count"));var a=0;e.end=scheduler.date.add(new Date(e.start),r+a,t.join("_"))}return t.join("_")+"#"+r}function n(e){var t=e.end;if(t.length){for(var r=0;r<t.length;r++)if(t[r].checked)return t[r].value&&"on"!==t[r].value?t[r].value:r?2===r?"date_of_end":"occurences_count":"no"}else if(t.value)return t.value;return"no"}function d(e,t){var r=e.end;if(r.length){var s=!!r[0].value&&"on"!==r[0].value;if(s)for(var a=0;a<r.length;a++)r[a].value===t&&(r[a].checked=!0);else{var i=0;switch(t){case"no":i=0;break;case"date_of_end":i=2;break;default:i=1}r[i].checked=!0}}else r.value=t}function l(e,t){var r=scheduler.form_blocks.recurring._set_node_value,s=e.split("#");switch(e=s[0].split("_"),b[e[0]](e,t),s[1]){case"no":d(g,"no");break;case"":d(g,"date_of_end");var a=t.end;scheduler.config.include_end_by&&(a=scheduler.date.add(a,-1,"day")),r(g,"date_of_end",v(a));break;default:d(g,"occurences_count"),r(g,"occurences_count",s[1])}r(g,"repeat",e[0]);var i=scheduler.form_blocks.recurring._get_form_node(g,"repeat",e[0]);"SELECT"===i.nodeName&&i.onchange?i.onchange():i.onclick&&i.onclick()}var _=scheduler.form_blocks.recurring,o=_._get_node_value,c=_._set_node_value;scheduler.form_blocks.recurring._ds={start:r.start_date,end:r._end_date};var h=scheduler.date.str_to_date(scheduler.config.repeat_date),u=function(e){var t=h(e);return scheduler.config.include_end_by&&(t=scheduler.date.add(t,1,"day")),t},v=scheduler.date.date_to_str(scheduler.config.repeat_date),f=e.getElementsByTagName("FORM")[0],g={};if(s(f.getElementsByTagName("INPUT")),s(f.getElementsByTagName("SELECT")),!scheduler.config.repeat_date_of_end){var m=scheduler.date.date_to_str(scheduler.config.repeat_date);scheduler.config.repeat_date_of_end=m(scheduler.date.add(scheduler._currentDate(),30,"day"))}c(g,"date_of_end",scheduler.config.repeat_date_of_end);var p=function(e){return document.getElementById(e)||{style:{}}};scheduler.form_blocks.recurring._get_repeat_code=i;var y={month:function(e,t){var r=scheduler.form_blocks.recurring._get_node_value;"d"===r(g,"month_type")?(e.push(Math.max(1,r(g,"month_count"))),t.start.setDate(r(g,"month_day"))):(e.push(Math.max(1,r(g,"month_count2"))),e.push(r(g,"month_day2")),e.push(Math.max(1,r(g,"month_week2"))),scheduler.config.repeat_precise||t.start.setDate(1)),t._start=!0},week:function(e,t){var r=scheduler.form_blocks.recurring._get_node_value;e.push(Math.max(1,r(g,"week_count"))),e.push(""),e.push("");for(var s=[],a=r(g,"week_day",!0),i=t.start.getDay(),n=!1,d=0;d<a.length;d++)s.push(a[d]),n=n||a[d]===i;s.length||(s.push(i),n=!0),s.sort(),scheduler.config.repeat_precise?n||(scheduler.transpose_day_week(t.start,s,1,7),t._start=!0):(t.start=scheduler.date.week_start(t.start),t._start=!0),e.push(s.join(","))},day:function(e){var t=scheduler.form_blocks.recurring._get_node_value;"d"===t(g,"day_type")?e.push(Math.max(1,t(g,"day_count"))):(e.push("week"),e.push(1),e.push(""),e.push(""),e.push(scheduler.config.recurring_workdays.join(",")),e.splice(0,1))},year:function(e,t){var r=scheduler.form_blocks.recurring._get_node_value;"d"===r(g,"year_type")?(e.push("1"),t.start.setMonth(0),t.start.setDate(r(g,"year_day")),t.start.setMonth(r(g,"year_month"))):(e.push("1"),e.push(r(g,"year_day2")),e.push(r(g,"year_week2")),t.start.setDate(1),t.start.setMonth(r(g,"year_month2"))),t._start=!0}},b={week:function(e,t){var r=scheduler.form_blocks.recurring._set_node_value;r(g,"week_count",e[1]);for(var s=e[4].split(","),a={},i=0;i<s.length;i++)a[s[i]]=!0;r(g,"week_day",a)},month:function(e,t){var r=scheduler.form_blocks.recurring._set_node_value;""===e[2]?(r(g,"month_type","d"),r(g,"month_count",e[1]),r(g,"month_day",t.start.getDate())):(r(g,"month_type","w"),r(g,"month_count2",e[1]),r(g,"month_week2",e[3]),r(g,"month_day2",e[2]))},day:function(e,t){var r=scheduler.form_blocks.recurring._set_node_value;r(g,"day_type","d"),r(g,"day_count",e[1])},year:function(e,t){var r=scheduler.form_blocks.recurring._set_node_value;""===e[2]?(r(g,"year_type","d"),r(g,"year_day",t.start.getDate()),r(g,"year_month",t.start.getMonth())):(r(g,"year_type","w"),r(g,"year_week2",e[3]),r(g,"year_day2",e[2]),r(g,"year_month2",t.start.getMonth()))}};scheduler.form_blocks.recurring._set_repeat_code=l;for(var x=0;x<f.elements.length;x++){var w=f.elements[x];switch(w.name){case"repeat":"SELECT"===w.nodeName?w.onchange=a:w.onclick=a}}scheduler._lightbox._rec_init_done=!0},set_value:function(e,t,r){var s=scheduler.form_blocks.recurring;scheduler._lightbox._rec_init_done||s._init_set_value(e,t,r),e.open=!r.rec_type,this._is_modified_occurence(r)?e.blocked=!0:e.blocked=!1;var a=s._ds;a.start=r.start_date,a.end=r._end_date,s.button_click(0,e.previousSibling.firstChild.firstChild,e,e),t&&s._set_repeat_code(t,a)},get_value:function(e,t){if(e.open){var r=scheduler.form_blocks.recurring._ds,s={};this.formSection("time").getValue(s),r.start=s.start_date,t.rec_type=scheduler.form_blocks.recurring._get_repeat_code(r),r._start?(t.start_date=new Date(r.start),t._start_date=new Date(r.start),r._start=!1):t._start_date=null,t._end_date=r.end,t.rec_pattern=t.rec_type.split("#")[0]}else t.rec_type=t.rec_pattern="",t._end_date=t.end_date;return t.rec_type},_get_button:function(){var e=scheduler.formSection("recurring").header;return e.firstChild.firstChild},_get_form:function(){return scheduler.formSection("recurring").node},open:function(){var e=scheduler.form_blocks.recurring,t=e._get_form();t.open||e._toggle_block()},close:function(){var e=scheduler.form_blocks.recurring,t=e._get_form();t.open&&e._toggle_block()},_toggle_block:function(){var e=scheduler.form_blocks.recurring,t=e._get_form(),r=e._get_button();t.open||t.blocked?(t.style.height="0px",r&&(r.style.backgroundPosition="-5px 20px",r.nextSibling.innerHTML=scheduler.locale.labels.button_recurring)):(t.style.height="auto",r&&(r.style.backgroundPosition="-5px 0px",r.nextSibling.innerHTML=scheduler.locale.labels.button_recurring_open)),t.open=!t.open,scheduler.setLightboxSize()},focus:function(e){},button_click:function(e,t,r,s){scheduler.form_blocks.recurring._toggle_block()}},scheduler._rec_markers={},scheduler._rec_markers_pull={},scheduler._rec_temp=[],scheduler._add_rec_marker=function(e,t){e._pid_time=t,this._rec_markers[e.id]=e,this._rec_markers_pull[e.event_pid]||(this._rec_markers_pull[e.event_pid]={}),this._rec_markers_pull[e.event_pid][t]=e},scheduler._get_rec_marker=function(e,t){var r=this._rec_markers_pull[t];return r?r[e]:null},scheduler._get_rec_markers=function(e){return this._rec_markers_pull[e]||[]},scheduler.attachEvent("onEventIdChange",function(e,t){if(!this._ignore_call){this._ignore_call=!0,scheduler._rec_markers[e]&&(scheduler._rec_markers[t]=scheduler._rec_markers[e],delete scheduler._rec_markers[e]);for(var r=0;r<this._rec_temp.length;r++){var s=this._rec_temp[r];s.event_pid===e&&(s.event_pid=t,this.changeEventId(s.id,t+"#"+s.id.split("#")[1]))}delete this._ignore_call}}),scheduler.attachEvent("onConfirmedBeforeEventDelete",function(e){var t=this.getEvent(e);if(this._is_virtual_event(e)||this._is_modified_occurence(t)&&t.rec_type&&"none"!==t.rec_type){e=e.split("#");var r=this.uid(),s=e[1]?e[1]:t._pid_time/1e3,a=this._copy_event(t);a.id=r,a.event_pid=t.event_pid||e[0];var i=s;a.event_length=i,a.rec_type=a.rec_pattern="none",this.addEvent(a),this._add_rec_marker(a,1e3*i)}else{t.rec_type&&this._lightbox_id&&this._roll_back_dates(t);var n=this._get_rec_markers(e);for(var d in n)n.hasOwnProperty(d)&&(e=n[d].id,this.getEvent(e)&&this.deleteEvent(e,!0))}return!0}),scheduler.attachEvent("onEventDeleted",function(e,t){!this._is_virtual_event(e)&&this._is_modified_occurence(t)&&(scheduler._events[e]||(t.rec_type=t.rec_pattern="none",this.setEvent(e,t)))}),scheduler.attachEvent("onEventChanged",function(e){if(this._loading)return!0;var t=this.getEvent(e);if(this._is_virtual_event(e)){var e=e.split("#"),r=this.uid();this._not_render=!0;var s=this._copy_event(t);s.id=r,s.event_pid=e[0];var a=e[1];s.event_length=a,s.rec_type=s.rec_pattern="",this._add_rec_marker(s,1e3*a),this.addEvent(s),this._not_render=!1}else{t.rec_type&&this._lightbox_id&&this._roll_back_dates(t);var i=this._get_rec_markers(e);for(var n in i)i.hasOwnProperty(n)&&(delete this._rec_markers[i[n].id],this.deleteEvent(i[n].id,!0));delete this._rec_markers_pull[e];for(var d=!1,l=0;l<this._rendered.length;l++)this._rendered[l].getAttribute("data-event-id")===e&&(d=!0);d||(this._select_id=null)}return!0}),scheduler.attachEvent("onEventAdded",function(e){if(!this._loading){var t=this.getEvent(e);t.rec_type&&!t.event_length&&this._roll_back_dates(t)}return!0}),scheduler.attachEvent("onEventSave",function(e,t,r){var s=this.getEvent(e);return s.rec_type||!t.rec_type||this._is_virtual_event(e)||(this._select_id=null),!0}),scheduler.attachEvent("onEventCreated",function(e){var t=this.getEvent(e);return t.rec_type||(t.rec_type=t.rec_pattern=t.event_length=t.event_pid=""),!0}),scheduler.attachEvent("onEventCancel",function(e){var t=this.getEvent(e);t.rec_type&&(this._roll_back_dates(t),this.render_view_data())}),scheduler._roll_back_dates=function(e){e.event_length=(e.end_date.valueOf()-e.start_date.valueOf())/1e3,e.end_date=e._end_date,e._start_date&&(e.start_date.setMonth(0),e.start_date.setDate(e._start_date.getDate()),e.start_date.setMonth(e._start_date.getMonth()),e.start_date.setFullYear(e._start_date.getFullYear()))},scheduler._is_virtual_event=function(e){return-1!==e.toString().indexOf("#")},scheduler._is_modified_occurence=function(e){return e.event_pid&&"0"!==e.event_pid},scheduler.showLightbox_rec=scheduler.showLightbox,scheduler.showLightbox=function(e){var t=this.locale,r=scheduler.config.lightbox_recurring,s=this.getEvent(e),a=s.event_pid,i=this._is_virtual_event(e);i&&(a=e.split("#")[0]);var n=function(e){var t=scheduler.getEvent(e);return t._end_date=t.end_date,t.end_date=new Date(t.start_date.valueOf()+1e3*t.event_length),scheduler.showLightbox_rec(e)};if((a||1*a===0)&&s.rec_type)return n(e);if(!a||"0"===a||!t.labels.confirm_recurring||"instance"===r||"series"===r&&!i)return this.showLightbox_rec(e);if("ask"===r){var d=this;Scheduler.component.modalbox({text:t.labels.confirm_recurring,title:t.labels.title_confirm_recurring,width:"500px",position:"middle",buttons:[t.labels.button_edit_series,t.labels.button_edit_occurrence,t.labels.icon_cancel],callback:function(t){switch(+t){case 0:return n(a);case 1:return d.showLightbox_rec(e);case 2:return}}})}else n(a)},scheduler.get_visible_events_rec=scheduler.get_visible_events,scheduler.get_visible_events=function(e){for(var t=0;t<this._rec_temp.length;t++)delete this._events[this._rec_temp[t].id];this._rec_temp=[];for(var r=this.get_visible_events_rec(e),s=[],t=0;t<r.length;t++)r[t].rec_type?"none"!==r[t].rec_pattern&&this.repeat_date(r[t],s):s.push(r[t]);return s},scheduler.transpose_day_week=function(e,t,r,s,a){for(var i=(e.getDay()||(scheduler.config.start_on_monday?7:0))-r,n=0;n<t.length;n++)if(t[n]>i)return e.setDate(e.getDate()+1*t[n]-i-(s?r:a));this.transpose_day_week(e,t,r+s,null,r)},scheduler.transponse_size={day:1,week:7,month:1,year:12},scheduler.transpose_type=function(e){var t="transpose_"+e;if(!this.date[t]){var r=e.split("_"),s=864e5,a="add_"+e,i=this.transponse_size[r[0]]*r[1];if("day"===r[0]||"week"===r[0]){var n=null;if(r[4]&&(n=r[4].split(","),scheduler.config.start_on_monday)){for(var d=0;d<n.length;d++)n[d]=1*n[d]||7;n.sort()}this.date[t]=function(e,t){var r=Math.floor((t.valueOf()-e.valueOf())/(s*i));r>0&&e.setDate(e.getDate()+r*i),n&&scheduler.transpose_day_week(e,n,1,i)},this.date[a]=function(e,t){var r=new Date(e.valueOf());if(n)for(var s=0;t>s;s++)scheduler.transpose_day_week(r,n,0,i);else r.setDate(r.getDate()+t*i);return r}}else("month"===r[0]||"year"===r[0])&&(this.date[t]=function(e,t){var s=Math.ceil((12*t.getFullYear()+1*t.getMonth()-(12*e.getFullYear()+1*e.getMonth()))/i);s>=0&&e.setMonth(e.getMonth()+s*i),r[3]&&scheduler.date.day_week(e,r[2],r[3])},this.date[a]=function(e,t){var s=new Date(e.valueOf());return s.setMonth(s.getMonth()+t*i),r[3]&&scheduler.date.day_week(s,r[2],r[3]),s})}},scheduler.repeat_date=function(e,t,r,s,a){s=s||this._min_date,a=a||this._max_date;var i=new Date(e.start_date.valueOf());for(!e.rec_pattern&&e.rec_type&&(e.rec_pattern=e.rec_type.split("#")[0]),this.transpose_type(e.rec_pattern),scheduler.date["transpose_"+e.rec_pattern](i,s);i<e.start_date||scheduler._fix_daylight_saving_date(i,s,e,i,new Date(i.valueOf()+1e3*e.event_length)).valueOf()<=s.valueOf()||i.valueOf()+1e3*e.event_length<=s.valueOf();)i=this.date.add(i,1,e.rec_pattern);for(;a>i&&i<e.end_date;){var n=scheduler.config.occurrence_timestamp_in_utc?Date.UTC(i.getFullYear(),i.getMonth(),i.getDate(),i.getHours(),i.getMinutes(),i.getSeconds()):i.valueOf(),d=this._get_rec_marker(n,e.id);if(d)r&&t.push(d);else{var l=new Date(i.valueOf()+1e3*e.event_length),_=this._copy_event(e);if(_.text=e.text,_.start_date=i,_.event_pid=e.id,_.id=e.id+"#"+Math.ceil(n/1e3),_.end_date=l,_.end_date=scheduler._fix_daylight_saving_date(_.start_date,_.end_date,e,i,_.end_date),_._timed=this.isOneDayEvent(_),!_._timed&&!this._table_view&&!this.config.multi_day)return;t.push(_),r||(this._events[_.id]=_,this._rec_temp.push(_))}i=this.date.add(i,1,e.rec_pattern)}},scheduler._fix_daylight_saving_date=function(e,t,r,s,a){var i=e.getTimezoneOffset()-t.getTimezoneOffset();return i?i>0?new Date(s.valueOf()+1e3*r.event_length-60*i*1e3):new Date(t.valueOf()-60*i*1e3):new Date(a.valueOf())},scheduler.getRecDates=function(e,t){var r="object"==typeof e?e:scheduler.getEvent(e),s=0,a=[];t=t||100;var i=new Date(r.start_date.valueOf()),n=new Date(i.valueOf());if(!r.rec_type)return[{start_date:r.start_date,end_date:r.end_date}];if("none"===r.rec_type)return[];for(this.transpose_type(r.rec_pattern),scheduler.date["transpose_"+r.rec_pattern](i,n);i<r.start_date||i.valueOf()+1e3*r.event_length<=n.valueOf();)i=this.date.add(i,1,r.rec_pattern);for(;i<r.end_date;){var d=this._get_rec_marker(i.valueOf(),r.id),l=!0;if(d)"none"===d.rec_type?l=!1:a.push({start_date:d.start_date,end_date:d.end_date});else{var _=new Date(i),o=new Date(i.valueOf()+1e3*r.event_length);o=scheduler._fix_daylight_saving_date(_,o,r,i,o),a.push({start_date:_,end_date:o})}if(i=this.date.add(i,1,r.rec_pattern),l&&(s++,s===t))break}return a},scheduler.getEvents=function(e,t){var r=[];for(var s in this._events){var a=this._events[s];if(a&&a.start_date<t&&a.end_date>e)if(a.rec_pattern){if("none"===a.rec_pattern)continue;var i=[];this.repeat_date(a,i,!0,e,t);for(var n=0;n<i.length;n++)!i[n].rec_pattern&&i[n].start_date<t&&i[n].end_date>e&&!this._rec_markers[i[n].id]&&r.push(i[n])}else this._is_virtual_event(a.id)||r.push(a)}return r},scheduler.attachEvent("onClearAll",function(){scheduler._rec_markers={},scheduler._rec_markers_pull={},scheduler._rec_temp=[]}),scheduler.templates.month_tooltip=function(e,t,r){var s={transaction_entity:r.cd$transaction_entity,partner_name:"",trade_terms:r.info.nm$trade_terms,delivery_type:r.info.nm$category_delivery_type,addr:r.info.addr_place_of_delivery.f,member:r.nm$member_public.a};"release"===r.type?s.partner_name=r.info.nm$partner_buyer:"departure"===r.type?s.partner_name=r.info.nm$partner_buyer:"wearing"===r.type&&(s.partner_name=r.info.nm$partner_supplier);var a="";return a+="<table data-event-id='"+r.id+"'>",a+="<col style='width:100px;' /><col style='width:200px;overflow:hidden;' />",a+="<tr><td class='sdr_cal_event'>거래 번호</td><td class='sdr_cal_event'>"+s.transaction_entity+"</td></tr>",a+="<tr><td class='sdr_cal_event'>거래처</td><td class='sdr_cal_event'>"+s.partner_name+"</td></tr>",a+="<tr><td class='sdr_cal_event'>거래 조건</td><td class='sdr_cal_event'>"+s.trade_terms+"</td></tr>",a+="<tr><td class='sdr_cal_event'>배송 방법</td><td class='sdr_cal_event'>"+s.delivery_type+"</td></tr>",a+="<tr><td class='sdr_cal_event'>배송 도시</td><td class='sdr_cal_event'>"+s.addr+"</td></tr>",a+="<tr><td class='sdr_cal_event'>거래 담당자</td><td class='sdr_cal_event'>"+s.member+"</td></tr>",a+="</table>"},function(){scheduler._hideMonthToolTip=function(){this._tooltip&&(this._tooltip.style.display="none",this._tooltip.id="")},scheduler._showMonthToolTip=function(e,t,r){var s=r.getAttribute("data-event-id")||"";if(s){var a=scheduler.getEvent(s);if(this._tooltip){if(this._tooltip.id===s)return;this._tooltip.innerHTML=""}else{var i=this._tooltip=document.createElement("DIV");i.className="sdr_month_tooltip",document.body.appendChild(i),i.style.cssText="position:absolute;width:300px;background-color:#fff;border:1px solid #666;font-size:9pt;z-index:10000;",i.style.width="300px",i.style.position="absolute",i.style.zIndex="10000",i.onclick=scheduler._click.sdr_cal_data}var n=this.templates.month_tooltip(a.start_date,a.end_date,a);this._tooltip.style.display="block",this._tooltip.style.top="0px",document.body.offsetWidth-e.left-r.offsetWidth-this._tooltip.offsetWidth<0?this._tooltip.style.left=e.left-this._tooltip.offsetWidth+"px":this._tooltip.style.left=e.left+r.offsetWidth+"px",this._tooltip.id=s,this._tooltip.setAttribute("data-event-id",s),this._tooltip.innerHTML=n,document.body.offsetHeight-e.top-this._tooltip.offsetHeight<0?this._tooltip.style.top=e.top-this._tooltip.offsetHeight+r.offsetHeight+"px":this._tooltip.style.top=e.top+"px"}},scheduler._removeMonthTooltip=function(){var e=document.getElementsByClassName("sdr_month_tooltip")[0];e&&e.parentNode.removeChild(e),scheduler._tooltip=null},scheduler._month_view_tooltip_handler=function(e){if("month"===scheduler._mode){var e=e||event,t=e.target||e.srcElement;"a"===t.tagName.toLowerCase()&&(t=t.parentNode),-1!==(t.className||"").indexOf("sdr_cal_event")?scheduler._showMonthToolTip(Scheduler.util.getOffset(t),e,t):scheduler._hideMonthToolTip()}},scheduler._init_month_tooltip=function(){Scheduler.eventObject._detachDomEvent(scheduler._els.sdr_cal_data[0],"mouseover",scheduler._month_view_tooltip_handler),Scheduler.eventObject._attachDomEvent(scheduler._els.sdr_cal_data[0],"mouseover",scheduler._month_view_tooltip_handler)}}(),scheduler.templates.year_date=function(e){return scheduler.date.date_to_str(scheduler.config.year_date)(e)},scheduler.templates.year_month=scheduler.date.date_to_str("%F"),scheduler.templates.year_scale_date=scheduler.date.date_to_str("%D"),scheduler.templates.year_tooltip=function(e,t,r){return r.text},function(){scheduler.dblclick_sdr_month_head=function(e){if("year"===scheduler._mode){var t=e.target||e.srcElement;if(-1!==t.parentNode.className.indexOf("sdr_before")||-1!==t.parentNode.className.indexOf("sdr_after"))return!1;var r=this.templates.xml_date(t.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.getAttribute("data-date"));r.setDate(parseInt(t.innerHTML,10));var s=this.date.add(r,1,"day");!this.config.readonly&&this.config.dblclick_create&&this.addEventNow(r.valueOf(),s.valueOf(),e)}};var e=scheduler.changeEventId;scheduler.changeEventId=function(){e.apply(this,arguments),"year"===scheduler._mode&&this.year_view(!0)};var t=scheduler.render_data,r=scheduler.date.date_to_str("%Y/%m/%d"),s=scheduler.date.str_to_date("%Y/%m/%d");scheduler.render_data=function(e){if("year"!==scheduler._mode)return t.apply(this,arguments);for(var r=0;r<e.length;r++)this._year_render_event(e[r])};var a=scheduler.clear_view;scheduler.clear_view=function(){if("year"!==scheduler._mode)return a.apply(this,arguments);var e=scheduler._year_marked_cells,t=null;for(var r in e)e.hasOwnProperty(r)&&(t=e[r],t.className="sdr_month_head",t.setAttribute("data-date",""));scheduler._year_marked_cells={}},scheduler._hideYearToolTip=function(){this._tooltip&&(this._tooltip.style.display="none",this._tooltip.date=new Date(9999,0,1))},scheduler._showYearToolTip=function(e,t,r,s){if(this._tooltip){if(this._tooltip.date.valueOf()===e.valueOf())return;this._tooltip.innerHTML=""}else{var a=this._tooltip=document.createElement("DIV");a.className="sdr_year_tooltip",document.body.appendChild(a),a.onclick=scheduler._click.sdr_cal_data}for(var i=this.getEvents(e,this.date.add(e,1,"day")),n="",d=0;d<i.length;d++){var l=i[d];if(this.filter_event(l.id,l)){var _=l.color?"background:"+l.color+";":"",o=l.textColor?"color:"+l.textColor+";":"";n+="<div class='sdr_tooltip_line' style='"+_+o+"' data-event-id='"+i[d].id+"'>",n+="<div class='sdr_tooltip_date' style='"+_+o+"'>"+(i[d]._timed?this.templates.event_date(i[d].start_date):"")+"</div>",n+="<div class='sdr_event_icon icon_details'>&nbsp;</div>",n+=this.templates.year_tooltip(i[d].start_date,i[d].end_date,i[d])+"</div>"}}this._tooltip.style.display="",this._tooltip.style.top="0px",document.body.offsetWidth-t.left-this._tooltip.offsetWidth<0?this._tooltip.style.left=t.left-this._tooltip.offsetWidth+"px":this._tooltip.style.left=t.left+s.offsetWidth+"px",this._tooltip.date=e,this._tooltip.innerHTML=n,document.body.offsetHeight-t.top-this._tooltip.offsetHeight<0?this._tooltip.style.top=t.top-this._tooltip.offsetHeight+s.offsetHeight+"px":this._tooltip.style.top=t.top+"px"},scheduler._removeYearTooltip=function(){var e=document.getElementsByClassName("sdr_year_tooltip")[0];e&&e.parentNode.removeChild(e),scheduler._tooltip=null},scheduler._year_view_tooltip_handler=function(e){if("year"===scheduler._mode){var e=e||event,t=e.target||e.srcElement;"a"===t.tagName.toLowerCase()&&(t=t.parentNode),-1!==(t.className||"").indexOf("sdr_year_event")?scheduler._showYearToolTip(s(t.getAttribute("data-date")),Scheduler.util.getOffset(t),e,t):scheduler._hideYearToolTip()}},scheduler._init_year_tooltip=function(){Scheduler.eventObject._detachDomEvent(scheduler._els.sdr_cal_data[0],"mouseover",scheduler._year_view_tooltip_handler),Scheduler.eventObject._attachDomEvent(scheduler._els.sdr_cal_data[0],"mouseover",scheduler._year_view_tooltip_handler)},scheduler.attachEvent("onSchedulerResize",function(){return"year"===scheduler._mode?(this.year_view(!0),!1):!0}),scheduler._get_year_cell=function(e){var t=e.getMonth()+12*(e.getFullYear()-this._min_date.getFullYear())-this.week_starts._month,r=this._els.sdr_cal_data[0].childNodes[t],e=this.week_starts[t]+e.getDate()-1;return r.childNodes[2].firstChild.rows[Math.floor(e/7)].cells[e%7].firstChild},scheduler._year_marked_cells={},scheduler._mark_year_date=function(e,t){var s=r(e),a=this._get_year_cell(e),i=this.templates.event_class(t.start_date,t.end_date,t);scheduler._year_marked_cells[s]||(a.className="sdr_month_head sdr_year_event",a.setAttribute("data-date",s),scheduler._year_marked_cells[s]=a),a.className+=i?" "+i:""},scheduler._unmark_year_date=function(e){this._get_year_cell(e).className="sdr_month_head"},scheduler._year_render_event=function(e){var t=e.start_date;for(t=t.valueOf()<this._min_date.valueOf()?this._min_date:this.date.date_part(new Date(t));t<e.end_date;)if(this._mark_year_date(t,e),t=this.date.add(t,1,"day"),t.valueOf()>=this._max_date.valueOf())return},scheduler.year_view=function(e){var t;if(e&&(t=scheduler.xy.scale_height,scheduler.xy.scale_height=-1),scheduler._els.sdr_cal_header[0].style.display=e?"none":"",scheduler.set_sizes(),e&&(scheduler.xy.scale_height=t),scheduler._table_view=e,!this._load_mode||!this._load())if(e){if(scheduler._init_year_tooltip(),scheduler._reset_year_scale(),scheduler._load_mode&&scheduler._load())return void(scheduler._render_wait=!0);scheduler.render_view_data()}else scheduler._hideYearToolTip()},scheduler._reset_year_scale=function(){this._cols=[],this._colsS={};var e=[],t=this._els.sdr_cal_data[0],r=this.config;t.scrollTop=0,t.innerHTML="";var s=Math.floor(parseInt(t.style.width)/r.year_x),a=Math.floor((parseInt(t.style.height)-scheduler.xy.year_top)/r.year_y);190>a&&(a=190,s=Math.floor((parseInt(t.style.width)-scheduler.xy.scroll_width)/r.year_x));for(var i=s-11,n=0,d=document.createElement("DIV"),l=this.date.week_start(scheduler._currentDate()),_=0;7>_;_++)this._cols[_]=Math.floor(i/(7-_)),this._render_x_header(_,n,l,d),l=this.date.add(l,1,"day"),i-=this._cols[_],n+=this._cols[_];d.lastChild.className+=" sdr_scale_bar_last";for(var o=this.date[this._mode+"_start"](this.date.copy(this._date)),c=o,h=null,_=0;_<r.year_y;_++)for(var u=0;u<r.year_x;u++){h=document.createElement("DIV"),h.style.cssText="position:absolute;",h.setAttribute("data-date",this.templates.xml_format(o)),h.innerHTML="<div class='sdr_year_month'></div><div class='sdr_year_week'>"+d.innerHTML+"</div><div class='sdr_year_body'></div>",h.childNodes[0].innerHTML=this.templates.year_month(o);for(var v=this.date.week_start(o),f=this._reset_month_scale(h.childNodes[2],o,v),g=h.childNodes[2].firstChild.rows,m=g.length;6>m;m++){g[0].parentNode.appendChild(g[0].cloneNode(!0));for(var p=0,y=g[m].childNodes.length;y>p;p++)g[m].childNodes[p].className="sdr_after",g[m].childNodes[p].firstChild.innerHTML=scheduler.templates.month_day(f),f=scheduler.date.add(f,1,"day")}t.appendChild(h),h.childNodes[1].style.height=h.childNodes[1].childNodes[0].offsetHeight+"px";var b=Math.round((a-190)/2);h.style.marginTop=b+"px",this.set_xy(h,s-10,a-b-10,s*u+5,a*_+5+scheduler.xy.year_top),e[_*r.year_x+u]=(o.getDay()-(this.config.start_on_monday?1:0)+7)%7,o=this.date.add(o,1,"month")}this._els.sdr_cal_date[0].innerHTML=this.templates[this._mode+"_date"](c,o,this._mode),this.week_starts=e,e._month=c.getMonth(),this._min_date=c,this._max_date=o};var i=scheduler.getActionData;scheduler.getActionData=function(e){if("year"!==scheduler._mode)return i.apply(scheduler,arguments);var t=e?e.target:event.srcElement,r=scheduler._get_year_month_date(t),s=scheduler._get_year_month_cell(t),a=scheduler._get_year_day_indexes(s);return a&&r?(r=scheduler.date.add(r,a.week,"week"),r=scheduler.date.add(r,a.day,"day")):r=null,{date:r,section:null}},scheduler._get_year_day_indexes=function(e){var t=scheduler._get_year_el_node(e,this._locate_year_month_table);if(!t)return null;for(var r=0,s=0,r=0,a=t.rows.length;a>r;r++){for(var i=t.rows[r].getElementsByTagName("td"),s=0,n=i.length;n>s&&i[s]!==e;s++);if(n>s)break}return a>r?{day:s,week:r}:null},scheduler._get_year_month_date=function(e){if(e=scheduler._get_year_el_node(e,scheduler._locate_year_month_root),!e)return null;var t=e.getAttribute("data-date");return t?scheduler.date.week_start(scheduler.templates.xml_date(t)):null},scheduler._locate_year_month_day=function(e){return e.className&&-1!==e.className.indexOf("sdr_year_event")&&e.hasAttribute&&e.hasAttribute("date")};var n=scheduler._locate_event;scheduler._locate_event=function(e){var t=n.apply(scheduler,arguments);if(!t){var r=scheduler._get_year_el_node(e,scheduler._locate_year_month_day);if(!r||!r.hasAttribute("date"))return null;var s=scheduler.templates.xml_date(r.getAttribute("data-date")),a=scheduler.getEvents(s,scheduler.date.add(s,1,"day"));if(!a.length)return null;t=a[0].id}return t},scheduler._locate_year_month_cell=function(e){return"td"===e.nodeName.toLowerCase()},scheduler._locate_year_month_table=function(e){return"table"===e.nodeName.toLowerCase()},scheduler._locate_year_month_root=function(e){return e.hasAttribute&&e.hasAttribute("date")},scheduler._get_year_month_cell=function(e){return this._get_year_el_node(e,this._locate_year_month_cell)},scheduler._get_year_month_table=function(e){return this._get_year_el_node(e,this._locate_year_month_table)},scheduler._get_year_month_root=function(e){return this._get_year_el_node(this._get_year_month_table(e),this._locate_year_month_root)},scheduler._get_year_el_node=function(e,t){for(;e&&!t(e);)e=e.parentNode;return e}}(),scheduler.templates.list_time=function(e,t,r){return r._timed?this.day_date(r.start_date,r.end_date,r)+" "+this.event_date(e):scheduler.templates.day_date(e)+" ~ "+scheduler.templates.day_date(t)},scheduler.templates.list_text=function(e,t,r){return r.text},scheduler.templates.list_date=function(){return""},scheduler.attachEvent("onTemplatesReady",function(){function e(e){if(e){var t=scheduler.locale.labels;scheduler._els.sdr_cal_header[0].innerHTML="<div class='sdr_list_line'><div>"+t.date+"</div><span style='padding-left:25px'>"+t.description+"</span></div>",scheduler._table_view=!0,scheduler.set_sizes()}}function t(){var e=scheduler.get_visible_events();e.sort(function(e,t){return e.start_date>t.start_date?1:-1});for(var t="<div class='sdr_list_area'>",r=0;r<e.length;r++){var s=e[r],a=s.color?"background:"+s.color+";":"",i=s.textColor?"color:"+s.textColor+";":"",n=scheduler.templates.event_class(s.start_date,s.end_date,s);t+="<div class='sdr_list_line"+(n?" "+n:"")+"' data-event-id='"+s.id+"' style='"+i+a+(s._text_style||"")+"'><div class='sdr_list_event_time'>"+scheduler.templates.list_time(s.start_date,s.end_date,s)+"</div>",t+="<div class='sdr_event_icon icon_details'>&nbsp;</div>",t+="<span>"+scheduler.templates.list_text(s.start_date,s.end_date,s)+"</span></div>"}t+="<div class='sdr_v_border'></div></div>",scheduler._els.sdr_cal_data[0].innerHTML=t,scheduler._els.sdr_cal_data[0].childNodes[0].scrollTop=scheduler._listScrollTop||0;var d=scheduler._els.sdr_cal_data[0].childNodes[0],l=d.childNodes[d.childNodes.length-1];l.style.height=d.offsetHeight<scheduler._els.sdr_cal_data[0].offsetHeight?"100%":d.offsetHeight+"px";var _=scheduler._els.sdr_cal_data[0].firstChild.childNodes;scheduler._els.sdr_cal_date[0].innerHTML=scheduler.templates.list_date(scheduler._min_date,scheduler._max_date,scheduler._mode),scheduler._rendered=[];for(var r=0;r<_.length-1;r++)scheduler._rendered[r]=_[r]}var r=scheduler.dblclick_sdr_cal_data;scheduler.dblclick_sdr_cal_data=function(){if("list"===this._mode)!this.config.readonly&&this.config.dblclick_create&&this.addEventNow();else if(r)return r.apply(this,arguments)},scheduler.attachEvent("onSchedulerResize",function(){return"list"===this._mode?(this.list_view(!0),!1):!0});var s=scheduler.render_data;scheduler.render_data=function(e){return"list"!==this._mode?s.apply(this,arguments):void t()};var a=scheduler.render_view_data;scheduler.render_view_data=function(){return"list"===this._mode&&(scheduler._listScrollTop=scheduler._els.sdr_cal_data[0].childNodes[0].scrollTop,scheduler._els.sdr_cal_data[0].childNodes[0].scrollTop=0),a.apply(this,arguments)},scheduler.list_view=function(r){scheduler._min_date=scheduler.config.list_start||scheduler.date.list_start(scheduler._date),scheduler._max_date=scheduler.config.list_end||scheduler.date.add_list(scheduler._min_date,1),scheduler._table_view=!0,e(r),r&&t()}}),scheduler.showModalPage=function(e){window.JaceLog.log("function showModalPage id = "+e)},scheduler._internal_id=Scheduler._seed++,scheduler},Scheduler.util=Scheduler.eventObject=Scheduler.component={},Scheduler.util.ajax={get:function(e,t){var r=new Scheduler.xmlLoaderObject(!0);return r.async=!0,r.waitCall=t,r.loadXML(e),r},post:function(e,t,r){var s=new Scheduler.xmlLoaderObject(!0);return s.async=!0,s.waitCall=r,s.loadXML(e,!0,t),s}},Scheduler.xmlLoaderObject=function(e,t,r,s){return this.xmlDoc="",this.async="undefined"!=typeof r?r:!0,this.onloadAction=e||null,this.mainObject=t||null,this.waitCall=null,this.rSeed=s||!1,this},Scheduler.xmlLoaderObject.count=0,Scheduler.xmlLoaderObject.prototype.waitLoadFunction=function(e){var t=!0;return this.check=function(){if(e&&e.onloadAction&&(!e.xmlDoc.readyState||4===e.xmlDoc.readyState)){if(!t)return;t=!1,Scheduler.xmlLoaderObject.count++,"function"==typeof e.onloadAction&&e.onloadAction(e.mainObject,null,null,null,e),e.waitCall&&(e.waitCall.call(this,e),e.waitCall=null)}},this.check},Scheduler.xmlLoaderObject.prototype.getXMLTopNode=function(e,t){var r;if(this.xmlDoc.responseXML){var s=this.xmlDoc.responseXML.getElementsByTagName(e);0===s.length&&-1!==e.indexOf(":")&&(s=this.xmlDoc.responseXML.getElementsByTagName(e.split(":")[1])),r=s[0]}else r=this.xmlDoc.documentElement;return r?(this._retry=!1,r):!this._retry&&_isIE?(this._retry=!0,t=this.xmlDoc,this.loadXMLString(this.xmlDoc.responseText.replace(/^[\s]+/,""),!0),this.getXMLTopNode(e,t)):(Scheduler.componentError.throwError("LoadXML","Incorrect XML",[t||this.xmlDoc,this.mainObject]),document.createElement("DIV"))},Scheduler.xmlLoaderObject.prototype.loadXMLString=function(e,t){if(_isIE)this.xmlDoc=new ActiveXObject("Microsoft.XMLDOM"),this.xmlDoc.async=this.async,this.xmlDoc.onreadystatechange=function(){},this.xmlDoc.loadXML(e);else{var r=new DOMParser;this.xmlDoc=r.parseFromString(e,"text/xml")}t||(this.onloadAction&&this.onloadAction(this.mainObject,null,null,null,this),this.waitCall&&(this.waitCall(),this.waitCall=null))},Scheduler.xmlLoaderObject.prototype.loadXML=function(e,t,r){this.rSeed&&(e+=(-1!==e.indexOf("?")?"&":"?")+"a_sdr_rSeed="+(new Date).valueOf()),this.filePath=e,!_isIE&&window.XMLHttpRequest?this.xmlDoc=new XMLHttpRequest:this.xmlDoc=new ActiveXObject("Microsoft.XMLHTTP"),this.async&&(this.xmlDoc.onreadystatechange=new this.waitLoadFunction(this)),"string"==typeof t?this.xmlDoc.open(t,e,this.async):this.xmlDoc.open(t?"POST":"GET",e,this.async),t&&this.xmlDoc.setRequestHeader("Content-type","application/x-www-form-urlencoded"),this.xmlDoc.setRequestHeader("X-Requested-With","XMLHttpRequest"),this.xmlDoc.send(r),this.async||new this.waitLoadFunction(this)()},Scheduler.xmlLoaderObject.prototype.destructor=function(){return this._filterXPath=null,this._getAllNamedChilds=null,this._retry=null,this.async=null,this.rSeed=null,this.onloadAction=null,this.mainObject=null,this.xmlDoc=null,this.doXPath=null,this.doXPathOpera=null,this.loadXML=null,this.loadXMLString=null,this.xmlNodeToJSON=null,this.getXMLTopNode=null,null},Scheduler.xmlLoaderObject.prototype.xmlNodeToJSON=function(e){for(var t={},r=0;r<e.attributes.length;r++)t[e.attributes[r].name]=e.attributes[r].value;t._tagvalue=e.firstChild?e.firstChild.nodeValue:"";for(var r=0;r<e.childNodes.length;r++){var s=e.childNodes[r].tagName;s&&(t[s]||(t[s]=[]),t[s].push(this.xmlNodeToJSON(e.childNodes[r])))}return t},Scheduler.util.getAbsoluteLeft=function(e){return Scheduler.util.getOffset(e).left},Scheduler.util.getAbsoluteTop=function(e){return Scheduler.util.getOffset(e).top},Scheduler.util.getOffsetSum=function(e){for(var t=0,r=0;e;)t+=parseInt(e.offsetTop),r+=parseInt(e.offsetLeft),e=e.offsetParent;return{top:t,left:r}},Scheduler.util.getOffsetRect=function(e){var t=e.getBoundingClientRect(),r=document.body,s=document.documentElement,a=window.pageYOffset||s.scrollTop||r.scrollTop,i=window.pageXOffset||s.scrollLeft||r.scrollLeft,n=s.clientTop||r.clientTop||0,d=s.clientLeft||r.clientLeft||0,l=t.top+a-n,_=t.left+i-d;return{top:Math.round(l),left:Math.round(_)}},Scheduler.util.getOffset=function(e){return e.getBoundingClientRect?Scheduler.util.getOffsetRect(e):Scheduler.util.getOffsetSum(e)},Scheduler.util.getUrlSymbol=function(e){return-1!==e.indexOf("?")?"&":"?"};var _isFF=!1,_isIE=!1,_isOpera=!1,_isKHTML=!1,_isMacOS=!1,_isChrome=!1,_FFrv=!1,_KHTMLrv=!1,_OperaRv=!1;return-1!==navigator.userAgent.indexOf("Macintosh")&&(_isMacOS=!0),navigator.userAgent.toLowerCase().indexOf("chrome")>-1&&(_isChrome=!0),-1!==navigator.userAgent.indexOf("Safari")||-1!==navigator.userAgent.indexOf("Konqueror")?(_KHTMLrv=parseFloat(navigator.userAgent.substr(navigator.userAgent.indexOf("Safari")+7,5)),_KHTMLrv>525?(_isFF=!0,_FFrv=1.9):_isKHTML=!0):-1!==navigator.userAgent.indexOf("Opera")?(_isOpera=!0,_OperaRv=parseFloat(navigator.userAgent.substr(navigator.userAgent.indexOf("Opera")+6,3))):-1!==navigator.appName.indexOf("Microsoft")?(_isIE=!0,-1===navigator.appVersion.indexOf("MSIE 8.0")&&-1===navigator.appVersion.indexOf("MSIE 9.0")&&-1===navigator.appVersion.indexOf("MSIE 10.0")||"BackCompat"===document.compatMode||(_isIE=8)):"Netscape"===navigator.appName&&-1!==navigator.userAgent.indexOf("Trident")?_isIE=8:(_isFF=!0,_FFrv=parseFloat(navigator.userAgent.split("rv:")[1])),Scheduler.xmlLoaderObject.prototype.doXPath=function(e,t,r,s){if(_isKHTML||!_isIE&&!window.XPathResult)return this.doXPathOpera(e,t);if(_isIE)return t||(t=this.xmlDoc.nodeName?this.xmlDoc:this.xmlDoc.responseXML),t||Scheduler.componentError.throwError("LoadXML","Incorrect XML",[t||this.xmlDoc,this.mainObject]),r&&t.setProperty("SelectionNamespaces","xmlns:xsl='"+r+"'"),"single"===s?t.selectSingleNode(e):t.selectNodes(e)||new Array(0);var a=t;t||(t=this.xmlDoc.nodeName?this.xmlDoc:this.xmlDoc.responseXML),t||Scheduler.componentError.throwError("LoadXML","Incorrect XML",[t||this.xmlDoc,this.mainObject]),-1!==t.nodeName.indexOf("document")?a=t:(a=t,t=t.ownerDocument);var i=XPathResult.ANY_TYPE;"single"===s&&(i=XPathResult.FIRST_ORDERED_NODE_TYPE);var n=[],d=t.evaluate(e,a,function(e){return r},i,null);if(i===XPathResult.FIRST_ORDERED_NODE_TYPE)return d.singleNodeValue;for(var l=d.iterateNext();l;)n[n.length]=l,l=d.iterateNext();return n},Scheduler.xmlLoaderObject.prototype.doXPathOpera=function(e,t){var r=e.replace(/[\/]+/gi,"/").split("/"),s=null,a=1;if(!r.length)return[];if("."===r[0])s=[t];else{if(""!==r[0])return[];s=(this.xmlDoc.responseXML||this.xmlDoc).getElementsByTagName(r[a].replace(/\[[^\]]*\]/g,"")),a++}for(a;a<r.length;a++)s=this._getAllNamedChilds(s,r[a]);return-1!==r[a-1].indexOf("[")&&(s=this._filterXPath(s,r[a-1])),s},Scheduler.xmlLoaderObject.prototype._filterXPath=function(e,t){for(var r=[],t=t.replace(/[^\[]*\[\@/g,"").replace(/[\[\]\@]*/g,""),s=0;s<e.length;s++)e[s].getAttribute(t)&&(r[r.length]=e[s]);return r},Scheduler.xmlLoaderObject.prototype._getAllNamedChilds=function(e,t){var r=[];_isKHTML&&(t=t.toUpperCase());for(var s=0;s<e.length;s++)for(var a=0;a<e[s].childNodes.length;a++)_isKHTML?e[s].childNodes[a].tagName&&e[s].childNodes[a].tagName.toUpperCase()===t&&(r[r.length]=e[s].childNodes[a]):e[s].childNodes[a].tagName===t&&(r[r.length]=e[s].childNodes[a]);return r},Scheduler.eventObject._attachDomEvent=function(e,t,r){e.addEventListener?e.addEventListener(t,r,!1):e.attachEvent&&e.attachEvent("on"+t,r)},Scheduler.eventObject._detachDomEvent=function(e,t,r){e.removeEventListener?e.removeEventListener(t,r,!1):e.detachEvent&&e.detachEvent("on"+t,r)},_schedulerComponentError.prototype.catchError=function(e,t){this.catches[e]=t},_schedulerComponentError.prototype.throwError=function(e,t,r){return this.catches[e]?this.catches[e](e,t,r):this.catches.ALL?this.catches.ALL(e,t,r):(alert("Error type : "+arguments[0]+"\nDescription : "+arguments[1]),null)},Scheduler.componentError=new _schedulerComponentError,Scheduler.componentEventable=function(obj){obj.attachEvent=function(e,t,r){return e="ev_"+e.toLowerCase(),this[e]||(this[e]=new this.eventCatcher(r||this)),e+":"+this[e].addEvent(t)},obj.callEvent=function(e,t){return e="ev_"+e.toLowerCase(),this[e]?this[e].apply(this,t):!0},obj.checkEvent=function(e){return!!this["ev_"+e.toLowerCase()]},obj.eventCatcher=function(obj){var sdr_catch=[],z=function(){for(var e=!0,t=0;t<sdr_catch.length;t++)if(sdr_catch[t]){var r=sdr_catch[t].apply(obj,arguments);e=e&&r}return e};return z.addEvent=function(ev){return"function"!=typeof ev&&(ev=eval(ev)),ev?sdr_catch.push(ev)-1:!1},z.removeEvent=function(e){sdr_catch[e]=null},z},obj.detachEvent=function(e){if(e){var t=e.split(":");this[t[0]].removeEvent(t[1])}},obj.detachAllEvents=function(){for(var e in this)0===e.indexOf("ev_")&&(this.detachEvent(e),this[e]=null)},obj=null},function(){function e(e,t){var s=e.callback;r(!1),e.box.parentNode.removeChild(e.box),h=e.box=null,s&&s(t)}function t(t){if(h){t=t||event;var r=t.which||event.keyCode;return Scheduler.component.message.keyboard&&((13===r||32===r)&&e(h,!0),27===r&&e(h,!1)),t.preventDefault&&t.preventDefault(),!(t.cancelBubble=!0)}}function r(e){r.cover||(r.cover=document.createElement("DIV"),r.cover.onkeydown=t,r.cover.className="sdr_modal_cover",document.body.appendChild(r.cover)),e?r.cover.style.display="inline-block":(r.cover.style.display="none",document.body.removeChild(r.cover),r.cover=null)}function s(e,t,r){var s=r?r:e||"",a="sdr_"+s.toLowerCase().replace(/ /g,"_")+"_button";return"<div class='sdr_popup_button "+a+"' result='"+t+"' ><div>"+e+"</div></div>"}function a(e){u.area||(u.area=document.createElement("DIV"),u.area.className="sdr_message_area",u.area.style[u.position]="5px",document.body.appendChild(u.area)),u.hide(e.id);var t=document.createElement("DIV");return t.innerHTML="<div>"+e.text+"</div>",t.className="sdr-info sdr-"+e.type,t.onclick=function(){u.hide(e.id),e=null},"bottom"===u.position&&u.area.firstChild?u.area.insertBefore(t,u.area.firstChild):u.area.appendChild(t),e.expire>0&&(u.timers[e.id]=setTimeout(function(){u.hide(e.id)},e.expire)),u.pull[e.id]=t,t=null,e.id}function i(t,r,a){var i=document.createElement("DIV");i.className="sdr_modal_box sdr-"+t.type,i.setAttribute("sdrbox",1);var n="";if(t.width&&(i.style.width=t.width),t.height&&(i.style.height=t.height),t.title&&(n+='<div class="sdr_popup_title">'+t.title+"</div>"),n+='<div class="sdr_popup_text"><span>'+(t.content?"":t.text)+'</span></div><div class="sdr_popup_controls">',r){var d=t.ok||scheduler.locale.labels.message_ok;void 0===d&&(d="OK"),n+=s(d,!0,"ok")}if(a){var l=t.cancel||scheduler.locale.labels.message_cancel;void 0===l&&(l="Cancel"),n+=s(l,!1,"cancel")}if(t.buttons)for(var _=0;_<t.buttons.length;_++)n+=s(t.buttons[_],_);if(n+="</div>",i.innerHTML=n,t.content){var o=t.content;"string"==typeof o&&(o=document.getElementById(o)),"none"===o.style.display&&(o.style.display=""),i.childNodes[t.title?1:0].appendChild(o)}return i.onclick=function(r){r=r||event;var s=r.target||r.srcElement;if(s.className||(s=s.parentNode),"sdr_popup_button"===s.className.split(" ")[0]){var a=s.getAttribute("result");a="true"===a||("false"===a?!1:a),e(t,a)}},t.box=i,(r||a)&&(h=t),i}function n(e,s,a){var n=e.tagName?e:i(e,s,a);e.hidden||r(!0),document.body.appendChild(n);var d=Math.abs(Math.floor(((window.innerWidth||document.documentElement.offsetWidth)-n.offsetWidth)/2)),l=Math.abs(Math.floor(((window.innerHeight||document.documentElement.offsetHeight)-n.offsetHeight)/2));return"top"===e.position?n.style.top="-3px":n.style.top=l+"px",n.style.left=d+"px",n.onkeydown=t,n.focus(),e.hidden&&Scheduler.component.modalbox.hide(n),n}function d(e){return n(e,!0,!1)}function l(e){return n(e,!0,!0)}function _(e){return n(e)}function o(e,t,r){return"object"!=typeof e&&("function"==typeof t&&(r=t,t=""),e={text:e,type:t,callback:r}),e}function c(e,t,r,s){return"object"!=typeof e&&(e={text:e,type:t,expire:r,id:s}),e.id=e.id||u.uid(),e.expire=e.expire||u.expire,e}var h=null;Scheduler.eventObject._attachDomEvent(document,"keydown",t),Scheduler.component.alert=function(){var e=o.apply(this,arguments);return e.type=e.type||"confirm",d(e)},Scheduler.component.confirm=function(){var e=o.apply(this,arguments);return e.type=e.type||"alert",l(e)},Scheduler.component.modalbox=function(){var e=o.apply(this,arguments);return e.type=e.type||"alert",_(e)},Scheduler.component.modalbox.hide=function(e){for(;e&&e.getAttribute&&!e.getAttribute("sdrbox");)e=e.parentNode;e&&(e.parentNode.removeChild(e),r(!1))};var u=Scheduler.component.message=function(e,t,r,s){e=c.apply(this,arguments),e.type=e.type||"info";var i=e.type.split("-")[0];switch(i){case"alert":return d(e);case"confirm":return l(e);case"modalbox":return _(e);default:return a(e)}};u.seed=(new Date).valueOf(),u.uid=function(){return u.seed++},u.expire=4e3,u.keyboard=!0,u.position="top",u.pull={},u.timers={},u.hideAll=function(){for(var e in u.pull)u.hide(e)},u.hide=function(e){var t=u.pull[e];t&&t.parentElement&&(setTimeout(function(){t.parentElement.removeChild(t),t=null},2e3),t.className+=" hidden",u.timers[e]&&clearTimeout(u.timers[e]),delete u.pull[e])}}(),Scheduler.componentError.catchError("LoadXML",function(e,t,r){var s=r[0].responseText;switch(scheduler.config.ajax_error){case"alert":alert(s);break;case"console":}}),Scheduler.scheduler=Scheduler.getSchedulerInstance(),window.Lib.Ttw.CLASS.UIComponent.Scheduler=Scheduler,Scheduler});